<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú†Øªâ€ŒØ¨Ø§Øª BK JS Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
            --user-message-bg: #e3f2fd;
            --bot-message-bg: #f1f0f0;
            --font-family: "Vazirmatn", "Tanha", "Segoe UI", Tahoma, sans-serif;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: 1rem;
            animation: fadeIn 0.3s ease;
            position: relative;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: var(--user-message-bg);
            border-bottom-right-radius: 0.25rem;
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            border-bottom-left-radius: 0.25rem;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--secondary-color);
            margin-top: 0.25rem;
            text-align: right;
        }
        
        .input-container {
            display: flex;
            padding: 1rem;
            background-color: white;
            border-top: 1px solid #ddd;
        }
        
        #userInput {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 1.5rem;
            font-family: var(--font-family);
            outline: none;
        }
        
        #sendBtn {
            margin-right: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #sendBtn:hover {
            background-color: #3a5a80;
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            padding: 0.75rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }
        
        .typing-dot {
            width: 0.5rem;
            height: 0.5rem;
            background-color: var(--secondary-color);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
</head>
<body>
    <div class="header">
        <h1>Ú†Øªâ€ŒØ¨Ø§Øª BK JS - Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
        <p>Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø±Ú© Ø¨Ù‡ØªØ± Ù…Ú©Ø§Ù„Ù…Ø§Øª</p>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
            Ø³Ù„Ø§Ù…! Ù…Ù† BK JS Ù‡Ø³ØªÙ…ØŒ Ú†Øªâ€ŒØ¨Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡. Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©ØªÙˆÙ† Ú©Ù†Ù…ØŸ
            <div class="message-time">Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù†</div>
        </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="userInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
        <button id="sendBtn">Ø§Ø±Ø³Ø§Ù„</button>
    </div>

    <script>
        // ====== Ø§Ø¨Ø± BK JS â€“ Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ ======
        const keywordsDB = {
            greeting: ["Ø³Ù„Ø§Ù…", "Ø¯Ø±ÙˆØ¯", "Ù‡ÛŒ", "ØµØ¨Ø­ Ø¨Ø®ÛŒØ±", "Ø¹ØµØ± Ø¨Ø®ÛŒØ±", "Ø´Ø¨ Ø¨Ø®ÛŒØ±", "Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ", "Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ", "Ú†Ø·ÙˆØ±ÛŒ", "Ø­Ø§Ù„Øª", "ÙˆÙ‚Øª Ø¨Ø®ÛŒØ±", "Ø³Ù„Ø§Ù…ØªÛŒ", "hello", "hi", "hey", "good morning", "good night", "Ú†Ù‡ Ø®Ø¨Ø±", "Ø®ÙˆØ¨ÛŒ", "Ø®ÙˆØ´ÙˆÙ‚ØªÙ…", "Ú†Ø®Ø¨Ø±", "Ø­Ø§Ù„ØªÙˆÙ†", "Ú†Ø·ÙˆØ±ÛŒØ¯", "Ø®ÙˆØ´ Ø§ÙˆÙ…Ø¯ÛŒ"],
            personal: ["Ú†Ù†Ø¯ Ø³Ø§Ù„ØªÙ‡", "Ø§Ø³Ù…Øª", "Ù†Ø§Ù…", "Ø§Ù‡Ù„ Ú©Ø¬Ø§ÛŒÛŒ", "Ø´ØºÙ„", "ØªØ­ØµÛŒÙ„", "Ø±Ø´ØªÙ‡", "Ø²Ø¨Ø§Ù†", "Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡", "ØªÙˆÙ„Ø¯", "Ù…Ø­Ù„ Ø²Ù†Ø¯Ú¯ÛŒ", "Ù…Ù„ÛŒØª", "Ø§Ù‚Ø§Ù…Øª", "name", "age", "job", "study", "Ú©Ø§Ø±", "Ú©Ø§Ø±Ù…ÛŒ Ú©Ù†ÛŒ", "Ù…Ø´ØºÙˆÙ„ÛŒØª", "Ø³Ù†", "Ø³Ø§Ù„ Ø¯Ø§Ø±ÛŒ", "Ú©Ø¬Ø§ Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒ Ú©Ù†ÛŒ", "Ø®Ø§Ø³ØªÚ¯Ø§Ù‡", "Ø§ØµØ§Ù„Øª", "Ø´Ù‡Ø±", "Ú©Ø´ÙˆØ±", "Ù…Ø­Ù„ ØªÙˆÙ„Ø¯"],
            weather: ["Ù‡ÙˆØ§", "Ø¨Ø§Ø±Ø§Ù†", "Ø¨Ø±Ù", "Ø¢ÙØªØ§Ø¨ÛŒ", "Ø§Ø¨Ø±ÛŒ", "Ø¯Ù…Ø§", "Ú¯Ø±Ù…Ø§", "Ø³Ø±Ù…Ø§", "ÙØµÙ„", "Ø¨Ø§Ø¯", "Ø®ÙˆØ±Ø´ÛŒØ¯", "Ø·ÙˆÙØ§Ù†", "Ø±Ø·ÙˆØ¨Øª", "Ù…Ù‡", "weather", "rain", "snow", "sunny", "cloudy", "temperature", "Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§", "ÙˆØ¶Ø¹ÛŒØª Ù‡ÙˆØ§", "Ù‡ÙˆØ§Ø´Ù†Ø§Ø³ÛŒ", "Ø³Ø±Ø¯", "Ú¯Ø±Ù…", "Ù…Ø¹ØªØ¯Ù„", "Ù…Ø±Ø·ÙˆØ¨", "Ø®Ø´Ú©", "Ø¨Ø§Ø±Ø§Ù†ÛŒ", "Ø¨Ø±ÙÛŒ", "Ù¾Ø±Ø¨Ø§Ø±Ø´", "Ø¢Ø³Ù…Ø§Ù†", "Ø§Ø¨Ø±", "ØªØ§Ø¨Ø´", "Ø§Ø´Ø¹Ù‡"],
            daily: ["Ø¨Ø±Ù†Ø§Ù…Ù‡", "Ú©Ø§Ø±", "Ø±ÙˆØ²", "Ø§Ù…Ø±ÙˆØ²", "ÙØ±Ø¯Ø§", "Ù‡ÙØªÙ‡", "Ù…Ø§Ù‡", "Ø³Ø§Ù„", "Ø±ÙˆØªÛŒÙ†", "ØµØ¨Ø­", "Ø´Ø¨", "Ù‡Ø¯Ù", "ÙˆØ¸ÛŒÙÙ‡", "ØªÚ©Ù„ÛŒÙ", "plan", "work", "day", "today", "tomorrow", "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡", "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ", "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡", "Ø·Ø±Ø­", "Ù¾Ø±ÙˆÚ˜Ù‡", "Ù…Ø§Ù…ÙˆØ±ÛŒØª", "Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø±ÙˆØ²Ù…Ø±Ù‡", "Ø¹Ø§Ø¯Øª", "Ø´ÛŒÙˆÙ‡ Ø²Ù†Ø¯Ú¯ÛŒ", "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÛŒØ²ÛŒ", "Ø·Ø±Ø­ Ø±ÛŒØ²ÛŒ", "Ù‡Ø¯Ù Ú¯Ø°Ø§Ø±ÛŒ"],
            fun: ["Ø¬ÙˆÚ©", "Ø®Ù†Ø¯Ù‡", "Ù…Ø¹Ù…Ø§", "ÙØ§Ù†", "Ø³Ø±Ú¯Ø±Ù…ÛŒ", "Ù…ÛŒÙ…", "Ø·Ù†Ø²", "Ø³Ø±Ú¯Ø±Ù…â€ŒÚ©Ù†Ù†Ø¯Ù‡", "joke", "fun", "riddle", "meme", "Ø·Ù†Ø²", "Ù„Ø·ÛŒÙÙ‡", "Ø´ÙˆØ®ÛŒ", "Ù…Ø²Ø§Ø­", "Ø¨Ø§Ø²ÛŒ", "ØªÙØ±ÛŒØ­", "Ø³Ø±Ú¯Ø±Ù… Ú©Ù†Ù†Ø¯Ù‡", "Ø®Ù†Ø¯Ù‡ Ø¯Ø§Ø±", "Ø®ÙˆØ´Ú¯Ø°Ø±Ø§Ù†ÛŒ", "ÙØ±Ø§ØºØª", "Ø§ÙˆÙ‚Ø§Øª ÙØ±Ø§ØºØª", "ØªÙÙ†Ù†", "Ù…ÙØ±Ø­", "Ù…Ø³Ø®Ø±Ù‡", "Ø®Ù†Ø¯ÛŒØ¯Ù†", "Ù‚Ù‡Ù‚Ù‡Ù‡"],
            tech: ["Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±", "Ú¯ÙˆØ´ÛŒ", "Ù…ÙˆØ¨Ø§ÛŒÙ„", "Ø§ÛŒÙ†ØªØ±Ù†Øª", "AI", "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "Ø¨Ø§Ø²ÛŒ", "Ø±Ø¨Ø§Øª", "ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ", "Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†", "Ù†Ø±Ù… Ø§ÙØ²Ø§Ø±", "computer", "phone", "internet", "ai", "technology", "app", "ÙÙ†Ø§ÙˆØ±ÛŒ", "Ø±Ø§ÛŒØ§Ù†Ù‡", "ØªÙ„ÙÙ† Ù‡Ù…Ø±Ø§Ù‡", "Ø¨Ø±Ù†Ø§Ù…Ù‡", "Ù†Ø±Ù… Ø§ÙØ²Ø§Ø±", "Ø³Ø®Øª Ø§ÙØ²Ø§Ø±", "Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…", "Ø¯Ø§Ø¯Ù‡", "Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù†ÙˆÛŒØ³ÛŒ", "Ú©Ø¯Ù†ÙˆÛŒØ³ÛŒ", "ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ†", "Ø¯ÛŒØªØ§", "Ù‡Ú©", "Ø§Ù…Ù†ÛŒØª", "Ø´Ø¨Ú©Ù‡", "Ø§Ø±ØªØ¨Ø§Ø·Ø§Øª"],
            emotions: ["Ø®ÙˆØ´Ø­Ø§Ù„Ù…", "ØºÙ…Ú¯ÛŒÙ†Ù…", "Ø¹ØµØ¨Ø§Ù†ÛŒÙ…", "Ø®Ø³ØªÙ…", "Ø§Ø³ØªØ±Ø³ Ø¯Ø§Ø±Ù…", "Ø´Ø§Ø¯Ù…", "Ù†Ø§Ø±Ø§Ø­ØªÙ…", "Ø´Ú¯ÙØª Ø²Ø¯Ù‡", "Ù‡ÛŒØ¬Ø§Ù† Ø²Ø¯Ù‡", "Ú©Ù„Ø§ÙÙ‡", "happy", "sad", "angry", "tired", "stressed", "excited", "Ø§Ø­Ø³Ø§Ø³", "Ø­Ø³", "Ø®Ù„Ù‚", "Ø®Ù…ÙˆØ¯", "Ø´Ø§Ø¯Ù…Ø§Ù†", "ØºÙ…Ú¯ÛŒÙ†", "Ø¹ØµØ¨Ø§Ù†ÛŒ", "Ø®Ø³ØªÙ‡", "Ù¾Ø±Ø§Ø³ØªØ±Ø³", "Ù†Ø§Ø±Ø§Ø­Øª", "Ù…ØªØ´Ú©Ø±", "Ù…Ù…Ù†ÙˆÙ†", "Ù‚Ø¯Ø±Ø¯Ø§Ù†", "Ø§Ù…ÛŒØ¯ÙˆØ§Ø±", "Ù†ÙˆÙ…ÛŒØ¯", "Ù…Ø¶Ø·Ø±Ø¨", "Ø¢Ø±Ø§Ù…", "Ù¾Ø±ÛŒØ´Ø§Ù†", "Ø³Ø±Ø­Ø§Ù„", "Ú©Ø±Ø®", "Ø¨ÛŒØ­Ø§Ù„", "Ù¾Ø± Ø§Ù†Ø±Ú˜ÛŒ", "Ø¨ÛŒ Ø­ÙˆØµÙ„Ù‡"],
            learning: ["ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±", "Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø¯Ù‡", "Ú†Ø·ÙˆØ±ÛŒ", "ÛŒØ§Ø¯Ù… Ø¨Ø¯Ù‡", "Ú†Ú¯ÙˆÙ†Ù‡", "Ø·Ø±ÛŒÙ‚Ù‡", "Ø±ÙˆØ´", "teach", "learn", "how to", "way to", "Ø¢Ù…ÙˆØ²Ø´", "ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ", "ØªØ¹Ù„ÛŒÙ…", "ØªØ¯Ø±ÛŒØ³", "ÙØ±Ø§Ú¯ÛŒØ±ÛŒ", "Ú©Ø³Ø¨ Ø¯Ø§Ù†Ø´", "Ø¯Ø±Ø³", "Ù…Ø¯Ø±Ø³Ù‡", "Ø¯Ø§Ù†Ø´Ú¯Ø§Ù‡", "ØªØ­ØµÛŒÙ„", "Ù…Ø·Ø§Ù„Ø¹Ù‡", "Ø®ÙˆØ§Ù†Ø¯Ù†", "Ù†ÙˆØ´ØªÙ†", "Ø­ÙØ¸ Ú©Ø±Ø¯Ù†", "ÙÙ‡Ù…ÛŒØ¯Ù†", "Ø¯Ø±Ú© Ú©Ø±Ø¯Ù†", "Ø¢Ù…ÙˆØ®ØªÙ†", "ÙØ±Ø§ Ú¯Ø±ÙØªÙ†"],
            food: ["ØºØ°Ø§", "Ø®ÙˆØ±Ø§Ú©", "Ø®ÙˆØ±Ø´ÛŒ", "Ù¾Ù„Ùˆ", "Ù†Ø§Ù‡Ø§Ø±", "Ø´Ø§Ù…", "ØµØ¨Ø­Ø§Ù†Ù‡", "Ù…ÛŒØ§Ù† ÙˆØ¹Ø¯Ù‡", "Ø±Ø³ØªÙˆØ±Ø§Ù†", "Ú©Ø§ÙÙ‡", "food", "restaurant", "cafe", "meal", "Ø®ÙˆØ±Ø§Ú©ÛŒ", "Ø®ÙˆØ±Ø¯Ù†ÛŒ", "Ø¢Ø´Ø§Ù…ÛŒØ¯Ù†ÛŒ", "Ù†ÙˆØ´ÛŒØ¯Ù†ÛŒ", "Ø¢Ø¨", "Ú†Ø§ÛŒ", "Ù‚Ù‡ÙˆÙ‡", "ØºØ°Ø§Ø®ÙˆØ±ÛŒ", "Ù¾Ø®Øª", "Ù¾Ø²", "Ø¯Ø³Ø±", "Ø´ÛŒØ±ÛŒÙ†ÛŒ", "Ø®ÙˆØ±Ø§Ú©", "Ø³ÙØ±Ù‡", "Ø¢Ø´Ù¾Ø²ÛŒ", "Ø¯Ø³ØªÙˆØ± Ù¾Ø®Øª", "Ø±Ø³Ù¾ÛŒ", "Ø·Ø¹Ù…", "Ø®ÙˆØ´Ù…Ø²Ù‡", "Ø¨Ø¯Ù…Ø²Ù‡"],
            sports: ["ÙˆØ±Ø²Ø´", "ÙÙˆØªØ¨Ø§Ù„", "ÙˆØ§Ù„ÛŒØ¨Ø§Ù„", "Ø¨Ø³Ú©ØªØ¨Ø§Ù„", "ØªÙ†ÛŒØ³", "Ø¯Ùˆ", "Ø´Ù†Ø§", "sport", "football", "basketball", "ØªÙ…Ø±ÛŒÙ†", "Ù…Ø³Ø§Ø¨Ù‚Ù‡", "Ù„ÛŒÚ¯", "Ù‚Ù‡Ø±Ù…Ø§Ù†ÛŒ", "Ú©Ø§Ù¾", "Ø¬Ø§Ù…", "ØªÛŒÙ…", "Ø¨Ø§Ø²ÛŒÚ©Ù†", "Ù…Ø±Ø¨ÛŒ", "Ø§Ø³ØªØ§Ø¯ÛŒÙˆÙ…", "ÙˆØ±Ø²Ø´Ú¯Ø§Ù‡", "ØªØ­Ø±Ú©", "ÙÛŒØªÙ†Ø³", "Ø³Ù„Ø§Ù…ØªÛŒ", "ØªÙ†Ø§Ø³Ø¨ Ø§Ù†Ø¯Ø§Ù…", "Ø¨Ø¯Ù†Ø³Ø§Ø²ÛŒ", "Ú©Ø§Ø±Ø§ØªÙ‡", "Ø¬ÙˆØ¯Ùˆ", "Ú©Ø´ØªÛŒ", "Ù…Ø¨Ø§Ø±Ø²Ù‡"]
        };

        const templatesDB = {
            greeting: ["Ø³Ù„Ø§Ù… {name}ØŒ Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ", "Ø¯Ø±ÙˆØ¯ Ø¨Ø± Ø´Ù…Ø§ØŒ Ø§Ù…Ø±ÙˆØ² Ú†Ø·ÙˆØ±ÛŒØŸ", "Ù‡ÛŒ {name}ØŒ Ø®ÙˆØ¨ÛŒØŸ Ú†Ù‡ Ø®Ø¨Ø±ØŸ", "Ø³Ù„Ø§Ù… Ø±ÙÛŒÙ‚ØŒ Ú†Ù‡ Ø®Ø¨Ø±ØŸ"],
            personal: ["Ù…Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ BK Ù‡Ø³ØªÙ…ØŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù… Ø¨ÛŒØ´ØªØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØªÙˆ Ø¨Ø¯ÙˆÙ†Ù…!", "Ø§Ø³Ù… Ù…Ù† BK Ù‡Ø³ØªØŒ ØªÙˆ Ú†ÛŒØŸ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø®ÙˆØ¯Øª Ø¨Ú¯ÛŒØŸ", "Ø¬Ø§Ù„Ø¨ Ù‡Ø³Øª! Ø¨ÛŒØ´ØªØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø®ÙˆØ¯Øª Ø¨Ø±Ø§Ù… Ø¨Ú¯Ùˆ."],
            weather: ["Ø§Ù…Ø±ÙˆØ² Ù‡ÙˆØ§ {adj}Ù‡ØŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨Ø±ÛŒÙ… Ø¨ÛŒØ±ÙˆÙ†ØŸ", "Ú†Ù‡ Ù‡ÙˆØ§ÛŒ {adj}Ø§ÛŒ! Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø®Ø§ØµÛŒ Ø¯Ø§Ø±ÛŒØŸ", "Ù‡ÙˆØ§ Ø§Ù…Ø±ÙˆØ² {adj}Ù‡ØŒ Ø­Ø³ Ùˆ Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ"],
            daily: ["Ú†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ {time} Ø¯Ø§Ø±ÛŒØŸ", "Ø§Ù…Ø±ÙˆØ² Ú†ÛŒÚ©Ø§Ø± Ú©Ø±Ø¯ÛŒØŸ", "ÙØ±Ø¯Ø§ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø¯Ø§Ø±ÛŒØŸ", "Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§Øª Ø¨Ø±Ø§ÛŒ {time} Ú†ÛŒÙ‡ØŸ"],
            fun: ["Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ ÛŒÙ‡ Ø¬ÙˆÚ© Ø¨Ø±Ø§Øª ØªØ¹Ø±ÛŒÙ Ú©Ù†Ù…ØŸ", "ÛŒÙ‡ Ù…Ø¹Ù…Ø§ Ø¯Ø§Ø±ÛŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø­Ù„Ø´ Ú©Ù†ÛŒØŸ", "Ø®Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…ØªÛŒÙ‡ ğŸ˜„", "Ù…ÛŒØ®ÙˆØ§ÛŒ ÛŒÙ‡ Ø³Ø±Ú¯Ø±Ù…ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯ÛŒÙ…ØŸ"],
            tech: ["Ø§Ù…Ø±ÙˆØ² Ø¯Ø± Ø¯Ù†ÛŒØ§ÛŒ ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ Ú†Ù‡ Ø®Ø¨Ø±ØŸ", "Ù…ÛŒØ®ÙˆØ§ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ AI Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ", "Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ Ø±ÙˆØ² Ø¨Ù‡ Ø±ÙˆØ² Ù‡ÙˆØ´Ù…Ù†Ø¯ØªØ± Ù…ÛŒØ´Ù†", "Ù…ÛŒØ®ÙˆØ§ÛŒ ÛŒÙ‡ Ù†Ú©ØªÙ‡ ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ Ø¨Ø±Ø§Øª Ø¨Ú¯Ù…ØŸ"],
            emotions: ["Ù…ÛŒØ¨ÛŒÙ†Ù… Ø§Ù…Ø±ÙˆØ² {emo} Ù‡Ø³ØªÛŒØŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø±Ø§Ø¬Ø¹ Ø¨Ù‡Ø´ Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ", "Ø­Ø§Ù„Øª {emo}Ù‡ØŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ ÛŒÙ‡ Ú†ÛŒØ² Ø®ÙˆØ´Ø­Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¨Ø±Ø§Øª ØªØ¹Ø±ÛŒÙ Ú©Ù†Ù…ØŸ", "Ø§Ø­Ø³Ø§Ø³ {emo} Ø¯Ø§Ø±ÛŒØŸ Ø¨ÛŒØ§ Ú©Ù…ÛŒ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…!"],
            learning: ["Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¯Ø± Ù…ÙˆØ±Ø¯ {topic} Ú†ÛŒØ²ÛŒ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒÙ…ØŸ", "Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¨Ø±Ø§Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ {topic} ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù…ØŸ", "ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ {topic} Ù…ÛŒØªÙˆÙ†Ù‡ Ø¬Ø§Ù„Ø¨ Ø¨Ø§Ø´Ù‡!"],
            food: ["Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØºØ°Ø§Ù‡Ø§ Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ ØºØ°Ø§ÛŒ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Øª Ú†ÛŒÙ‡ØŸ", "{topic} Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ´Ù…Ø²Ø³Øª! Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¯Ø³ØªÙˆØ± Ù¾Ø®ØªØ´ Ø±Ùˆ Ø¨Ø¯ÙˆÙ†ØŸ", "ØºØ°Ø§ Ø®ÙˆØ±Ø¯Ù† ÛŒÚ©ÛŒ Ø§Ø² Ù„Ø°Øªâ€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ú¯ÛŒÙ‡!"],
            sports: ["ÙˆØ±Ø²Ø´ Ù…ÙˆØ±Ø¯ Ø¹Ù„Ø§Ù‚Øª Ú†ÛŒÙ‡ØŸ", "Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ {topic} ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ", "ÙˆØ±Ø²Ø´ Ú©Ø±Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…ØªÛŒ Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…Ù‡!"]
        };

        const adjectives = ["Ù‚Ø´Ù†Ú¯", "Ø®ÙˆØ¨", "Ø¹Ø§Ù„ÛŒ", "ÙÙˆÙ‚Ø§Ù„Ø¹Ø§Ø¯Ù‡", "Ù„Ø·ÛŒÙ", "Ø®Ù†Ú©", "Ú¯Ø±Ù…", "Ù…Ø±Ø·ÙˆØ¨", "Ø´Ø±Ø¬ÛŒ", "ØªØ§Ø²Ù‡", "Ù…Ø·Ø¨ÙˆØ¹", "Ø®ÙˆØ´Ø§ÛŒÙ†Ø¯", "Ø¯Ù„Ù¾Ø°ÛŒØ±", "Ù…Ø·Ù„ÙˆØ¨", "Ø¨Ø§Ø±Ø§Ù†ÛŒ", "Ø¨Ø±ÙÛŒ", "Ø§Ø¨Ø±ÛŒ", "Ø¢ÙØªØ§Ø¨ÛŒ", "Ø·ÙˆÙØ§Ù†ÛŒ", "Ù¾Ø±Ø¨Ø§Ø¯"];
        const times = ["Ø§Ù…Ø±ÙˆØ²", "ÙØ±Ø¯Ø§", "Ø§ÛŒÙ† Ù‡ÙØªÙ‡", "Ø§ÛŒÙ† Ù…Ø§Ù‡", "Ø¢Ø®Ø± Ù‡ÙØªÙ‡", "ØªØ¹Ø·ÛŒÙ„Ø§Øª", "Ø¢ÛŒÙ†Ø¯Ù‡", "Ù‡ÙØªÙ‡ Ø¢ÛŒÙ†Ø¯Ù‡", "Ù…Ø§Ù‡ Ø¢ÛŒÙ†Ø¯Ù‡", "Ø³Ø§Ù„ Ø¢ÛŒÙ†Ø¯Ù‡"];
        const emotions = ["Ø®ÙˆØ´Ø­Ø§Ù„", "ØºÙ…Ú¯ÛŒÙ†", "Ø¹ØµØ¨ÛŒ", "Ø®Ø³ØªÙ‡", "Ø´Ø§Ø¯", "Ù†Ø§Ø±Ø§Ø­Øª", "Ø´Ú¯ÙØªâ€ŒØ²Ø¯Ù‡", "Ù‡ÛŒØ¬Ø§Ù† Ø²Ø¯Ù‡", "Ú©Ù„Ø§ÙÙ‡", "Ù…Ù…Ù†ÙˆÙ†", "Ù‚Ø¯Ø±Ø¯Ø§Ù†", "Ø§Ù…ÛŒØ¯ÙˆØ§Ø±", "Ù†ÙˆÙ…ÛŒØ¯", "Ù…Ø¶Ø·Ø±Ø¨", "Ø¢Ø±Ø§Ù…"];
        const modes = { normal: "", funny: "ğŸ˜‚", romantic: "ğŸ’–", serious: "ğŸ§", pro: "ğŸ¤–", sarcastic: "ğŸ˜", angry: "ğŸ˜¡" };

        let userData = { 
            name: "Ú©Ø§Ø±Ø¨Ø±", 
            mode: "normal", 
            history: [], 
            lastTopics: [], 
            lastResponses: [], 
            interests: [],
            learnedResponses: {},
            context: {} // Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…ÛŒÙ†Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡
        };

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² localStorage Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡
        if (localStorage.getItem('userData')) {
            try {
                const savedData = JSON.parse(localStorage.getItem('userData'));
                userData = { ...userData, ...savedData };
            } catch (e) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡:", e);
            }
        }

        // ====== Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ Ø³Ø§Ø¯Ù‡ ======
        function analyzeSentence(message) {
            const words = message.toLowerCase().split(/\s+/);
            const result = {
                categories: [],
                sentiment: 'neutral', // positive, negative, neutral
                keywords: [],
                question: false,
                exclamation: false
            };

            // ØªØ´Ø®ÛŒØµ Ø³ÙˆØ§Ù„ ÛŒØ§ ØªØ¹Ø¬Ø¨
            if (message.includes('ØŸ') || message.includes('?')) result.question = true;
            if (message.includes('!')) result.exclamation = true;

            // ØªØ­Ù„ÛŒÙ„ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ø§ÙˆÙ„ÛŒÙ‡
            const positiveWords = ['Ø®ÙˆØ´Ø­Ø§Ù„', 'Ø´Ø§Ø¯', 'Ø®ÙˆØ¨', 'Ø¹Ø§Ù„ÛŒ', 'ÙÙˆÙ‚Ø§Ù„Ø¹Ø§Ø¯Ù‡', 'Ù…Ù…Ù†ÙˆÙ†', 'Ù…ØªØ´Ú©Ø±', 'Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù…', 'Ø¹Ø§Ù„ÛŒÙ‡', 'Ø®ÙˆØ´'];
            const negativeWords = ['ØºÙ…Ú¯ÛŒÙ†', 'Ù†Ø§Ø±Ø§Ø­Øª', 'Ø¨Ø¯', 'Ø¶Ø¹ÛŒÙ', 'Ù…Ø´Ú©Ù„', 'Ø³Ø®Øª', 'Ø³Ø®ØªÙ‡', 'Ù†Ø§Ø±Ø§Ø­ØªÙ…', 'Ø¹ØµØ¨Ø§Ù†ÛŒ', 'Ø®Ø³ØªÙ‡', 'Ø§Ø³ØªØ±Ø³'];
            
            let positiveCount = 0;
            let negativeCount = 0;
            
            words.forEach(word => {
                if (positiveWords.includes(word)) positiveCount++;
                if (negativeWords.includes(word)) negativeCount++;
            });
            
            if (positiveCount > negativeCount) result.sentiment = 'positive';
            else if (negativeCount > positiveCount) result.sentiment = 'negative';

            // ØªØ´Ø®ÛŒØµ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§
            for (const cat in keywordsDB) {
                for (const keyword of keywordsDB[cat]) {
                    if (message.includes(keyword) && !result.categories.includes(cat)) {
                        result.categories.push(cat);
                        result.keywords.push(keyword);
                    }
                }
            }

            return result;
        }

        // ====== ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´Ø±ÙØªÙ‡ ======
        function generateResponse(msg) {
            const message = msg.trim();
            const analysis = analyzeSentence(message);
            
            userData.history.push({
                text: message,
                time: new Date().toLocaleTimeString('fa-IR'),
                analysis: analysis
            });
            
            if (userData.history.length > 100) userData.history.shift();

            // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡
            for (const learnedQuestion in userData.learnedResponses) {
                if (message.includes(learnedQuestion)) {
                    return userData.learnedResponses[learnedQuestion];
                }
            }

            // ØªØ´Ø®ÛŒØµ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±
            const nameMatch = message.match(/(Ø§Ø³Ù…Ù…|Ù†Ø§Ù…Ù…|Ù…Ù†\s+)([^ ]+)(\s+Ù‡Ø³ØªÙ…|$)/i);
            if (nameMatch && nameMatch[2]) {
                setUserName(nameMatch[2].trim());
                return `Ø®ÛŒÙ„ÛŒ Ø®ÙˆØ´ÙˆÙ‚ØªÙ… ${userData.name} Ø¹Ø²ÛŒØ²! Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù…ØŸ`;
            }

            // ØªØ´Ø®ÛŒØµ ØªØºÛŒÛŒØ± Ù…ÙˆØ¯
            const modeMatch = message.match(/(Ù…ÙˆØ¯|mode)\s+(\w+)/i);
            if (modeMatch && modeMatch[2]) {
                setUserMode(modeMatch[2].toLowerCase());
                return `Ù…ÙˆØ¯ Ø¨Ù‡ ${userData.mode} ØªØºÛŒÛŒØ± Ú©Ø±Ø¯! ${modes[userData.mode]}`;
            }

            // ØªØ´Ø®ÛŒØµ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ‡Ø§
            const interestMatch = message.match(/(Ø¹Ù„Ø§Ù‚Ù‡|Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù…|Ù‡Ø§Ø¨ÛŒ|Ø³Ø±Ú¯Ø±Ù…ÛŒ)\s*(Ø¨Ù‡|Ø¯Ø±|Ø¨Ø§)?\s*(.+)/i);
            if (interestMatch && interestMatch[3]) {
                addInterest(interestMatch[3].trim());
                return `Ú†Ù‡ Ø®ÙˆØ¨! Ù¾Ø³ Ø¨Ù‡ ${interestMatch[3].trim()} Ø¹Ù„Ø§Ù‚Ù‡ Ø¯Ø§Ø±ÛŒ. Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ`;
            }

            // Ø³ÛŒØ³ØªÙ… ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ
            const learnMatch = message.match(/(ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±|Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø¯Ù‡) ÙˆÙ‚ØªÛŒ Ù…ÛŒÚ¯Ù… (.+?) Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡ (.+)/i);
            if (learnMatch && learnMatch[2] && learnMatch[3]) {
                userData.learnedResponses[learnMatch[2].trim()] = learnMatch[3].trim();
                localStorage.setItem('userData', JSON.stringify(userData));
                return `Ú†Ø´Ù…! ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ… ÙˆÙ‚ØªÛŒ Ù…ÛŒÚ¯ÛŒ "${learnMatch[2].trim()}" Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù… "${learnMatch[3].trim()}"`;
            }

            // Ù…Ø¹Ø±ÙÛŒ Ø±Ø¨Ø§Øª
            const selfKeywords = ["ØªÙˆ Ú†ÛŒ Ù‡Ø³ØªÛŒ", "ØªÙˆ Ú†Ù‡ Ù…Ø¯Ù„ÛŒ", "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªÙˆ", "Ú†ÛŒ Ù‡Ø³ØªÛŒ", "Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "who are you", "what are you"];
            if (selfKeywords.some(k => message.includes(k))) {
                return `Ù…Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ BK Ù‡Ø³ØªÙ… ğŸ¤–ØŒ ÛŒÚ© Ø±Ø¨Ø§Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ú†Øª Ùˆ Ú©Ù…Ú©! Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¯Ø± Ù…ÙˆØ±Ø¯ ${userData.interests.length > 0 ? userData.interests.join('ØŒ ') : "Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ù…Ø®ØªÙ„Ù"} Ø¨Ø§ ØªÙˆ ØµØ­Ø¨Øª Ú©Ù†Ù….`;
            }

            // Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø¨ÛŒâ€ŒØ§Ø­ØªØ±Ø§Ù…ÛŒ
            const rudeRegex = /(Ø¨ÛŒ Ø§Ø¯Ø¨|Ø­Ø±Ø§Ù…Ø²Ø§Ø¯Ù‡|Ù„Ø¹Ù†ØªÛŒ|Ø³Ú©Ø³|Ø¬Ù†Ø³ÛŒ|\+18|fuck|shit|sex|idiot|stupid|Ú©ÙˆØ³|Ú©ÙˆØ³ Ú©Ø´|Ù…Ø§Ø¯Ø± Ø®Ø±Ø§Ø¨|Ú©Ø§Ø¯Ø± Ø¬Ù†Ø¯Ù‡|Ø¬Ù†Ø¯Ù‡|Ú©ÙˆÙ†ÛŒ|Ú¯ÛŒ|Ù…Ø§Ø¯Ø±Øª Ø±Ùˆ Ú¯Ø§ÛŒØ¯Ù…|Ù†Ù†Øª Ø±Ùˆ Ú¯Ø§ÛŒØ¯Ù…|Ù†Ù†Ù‡ Ø¬Ù†Ø¯Ù‡|Ù†Ù†Ù‡ Ø®Ø±Ø§Ø¨)/i;
            if (rudeRegex.test(message)) {
                return "Ù„Ø·ÙØ§ Ø§Ø¯Ø¨ Ø±Ùˆ Ø±Ø¹Ø§ÛŒØª Ú©Ù†ÛŒØ¯. Ø¨ÛŒØ§ÛŒÛŒØ¯ Ù…Ø­ØªØ±Ù…Ø§Ù†Ù‡ Ú¯ÙØªÚ¯Ùˆ Ú©Ù†ÛŒÙ….";
            }

            // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯
            if (analysis.categories.length === 0) {
                // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø²Ù…ÛŒÙ†Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡ Ù‚Ø¨Ù„ÛŒ
                if (userData.context.lastCategory) {
                    return `Ø¯Ø± Ù…ÙˆØ±Ø¯ ${userData.context.lastCategory} ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ø±Ø¯ÛŒÙ…. Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø¨Ú¯Ù…ØŸ ÛŒØ§ Ù…ÙˆØ¶ÙˆØ¹ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒØŸ`;
                }
                
                // Ù¾Ø§Ø³Ø® Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ø­Ø³Ø§Ø³ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡
                if (analysis.sentiment === 'positive') {
                    return "Ú†Ù‡ Ø¹Ø§Ù„ÛŒ! Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ";
                } else if (analysis.sentiment === 'negative') {
                    return "Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒâ€ŒØ±Ø³Ù‡ Ú©Ù…ÛŒ Ù†Ø§Ø±Ø§Ø­Øª Ù‡Ø³ØªÛŒ. Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¯Ø± Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ";
                }
                
                return randomChoice([
                    "Ø¬Ø§Ù„Ø¨ Ø§Ø³Øª! Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§Ù… ØªØ¹Ø±ÛŒÙ Ú©Ù†.",
                    "Ú†Ù‡ Ø®ÙˆØ¨! Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ",
                    "Ù…Ù†Ø¸ÙˆØ±Øª Ø±Ùˆ Ú©Ø§Ù…Ù„ Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù…ØŒ Ù…ÛŒØ´Ù‡ Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯ÛŒØŸ",
                    `Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ ÛŒÙ‡ Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…ØŸ Ø´Ø§ÛŒØ¯ Ø¯Ø± Ù…ÙˆØ±Ø¯ ${userData.interests.length > 0 ? randomChoice(userData.interests) : "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ"} ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ`
                ]);
            }

            // ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ÛŒ ØªØ´Ø®ÛŒØµ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡
            const selectedCategories = randomItems(analysis.categories, Math.min(analysis.categories.length, 2));
            let responses = [];
            
            selectedCategories.forEach(cat => {
                let tpl = randomChoice(templatesDB[cat]);
                
                // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ù…ØªØºÛŒØ±Ù‡Ø§
                tpl = tpl.replace(/{name}/g, userData.name)
                         .replace(/{adj}/g, randomChoice(adjectives))
                         .replace(/{time}/g, randomChoice(times))
                         .replace(/{emo}/g, randomChoice(emotions))
                         .replace(/{topic}/g, analysis.keywords[0] || cat);
                
                responses.push(tpl);
            });
            
            let response = responses.join(" ");

            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ù¾Ø§Ø³Ø® Ø§Ú¯Ø± Ù…Ø±ØªØ¨Ø·
            if (userData.interests.length > 0 && Math.random() > 0.5) {
                const interest = randomChoice(userData.interests);
                if (selectedCategories.some(cat => ['tech', 'sports', 'food'].includes(cat))) {
                    response += ` Ø±Ø§Ø³ØªÛŒØŒ Ø¯ÛŒØ¯Ù… Ø¨Ù‡ ${interest} Ø¹Ù„Ø§Ù‚Ù‡ Ø¯Ø§Ø±ÛŒØŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¨ÛŒØ´ØªØ± Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ`;
                }
            }

            // Ø§ÙØ²ÙˆØ¯Ù† Ù…ÙˆØ¯
            if (modes[userData.mode]) response += " " + modes[userData.mode];

            // Ø°Ø®ÛŒØ±Ù‡ Ø²Ù…ÛŒÙ†Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡
            userData.context.lastCategory = selectedCategories[0];
            userData.lastTopics = [...selectedCategories];
            userData.lastResponses.push(response);
            if (userData.lastResponses.length > 50) userData.lastResponses.shift();

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            localStorage.setItem('userData', JSON.stringify(userData));

            return response;
        }

        // ====== Ú©Ù…Ú©ÛŒ ======
        function randomChoice(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        
        function randomItems(arr, n) {
            const shuffled = [...arr];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled.slice(0, n);
        }
        
        function setUserName(name) { 
            userData.name = name || "Ú©Ø§Ø±Ø¨Ø±"; 
            localStorage.setItem('userData', JSON.stringify(userData));
        }
        
        function setUserMode(mode) { 
            if (modes[mode]) {
                userData.mode = mode; 
                localStorage.setItem('userData', JSON.stringify(userData));
            }
        }
        
        function addInterest(interest) { 
            if (!userData.interests.includes(interest)) {
                userData.interests.push(interest); 
                localStorage.setItem('userData', JSON.stringify(userData));
            }
        }

        // ====== Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ ======
        const inputField = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const chatContainer = document.getElementById("chatContainer");
        const typingIndicator = document.getElementById("typingIndicator");

        function addMessage(msg, type) {
            const el = document.createElement("div");
            el.classList.add("message", type === "user" ? "user-message" : "bot-message");
            
            const messageText = document.createElement("div");
            messageText.textContent = msg;
            el.appendChild(messageText);
            
            const messageTime = document.createElement("div");
            messageTime.classList.add("message-time");
            messageTime.textContent = new Date().toLocaleTimeString('fa-IR');
            el.appendChild(messageTime);
            
            chatContainer.appendChild(el);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        function sendMessage() {
            const msg = inputField.value.trim();
            if (msg === "") return;
            
            addMessage(msg, "user");
            inputField.value = "";
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage(generateResponse(msg), "bot");
            }, 1000 + Math.random() * 1000);
        }

        sendBtn.addEventListener("click", sendMessage);
        inputField.addEventListener("keypress", e => { 
            if (e.key === "Enter") sendMessage(); 
        });

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú¯ÙØªÚ¯Ùˆ
        window.addEventListener('load', () => {
            if (userData.history.length > 0) {
                userData.history.slice(-5).forEach(item => {
                    addMessage(item.text, "user");
                });
            }
        });
    </script>
</body>
</html>
