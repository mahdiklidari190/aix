<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>چت‌بات هوشمند BK AI</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
            --user-message-bg: #e3f2fd;
            --bot-message-bg: #f1f0f0;
            --font-family: "Vazirmatn", "Tanha", "Segoe UI", Tahoma, sans-serif;
            --text-color: #333;
            --border-color: #ddd;
        }

        .dark-mode {
            --primary-color: #5a7fb5;
            --secondary-color: #8b9cb0;
            --background-color: #1a1a1a;
            --user-message-bg: #2a4b7c;
            --bot-message-bg: #3a3a3a;
            --text-color: #f0f0f0;
            --border-color: #444;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: 1rem;
            animation: fadeIn 0.3s ease;
            position: relative;
            border: 1px solid var(--border-color);
        }
        
        .user-message {
            align-self: flex-end;
            background-color: var(--user-message-bg);
            border-bottom-right-radius: 0.25rem;
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            border-bottom-left-radius: 0.25rem;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--secondary-color);
            margin-top: 0.25rem;
            text-align: right;
        }
        
        .input-container {
            display: flex;
            padding: 1rem;
            background-color: var(--bot-message-bg);
            border-top: 1px solid var(--border-color);
        }
        
        #userInput {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 1.5rem;
            font-family: var(--font-family);
            outline: none;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        #sendBtn {
            margin-right: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #sendBtn:hover {
            background-color: #3a5a80;
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            padding: 0.75rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }
        
        .typing-dot {
            width: 0.5rem;
            height: 0.5rem;
            background-color: var(--secondary-color);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .settings-btn {
            position: absolute;
            left: 1rem;
            top: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }

        .theme-toggle {
            position: absolute;
            right: 1rem;
            top: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
</head>
<body>
    <div class="header">
        <button class="settings-btn">⚙️</button>
        <button class="theme-toggle" id="themeToggle">🌙</button>
        <h1>چت‌بات هوشمند BK AI</h1>
        <p>هوش مصنوعی که واقعاً می‌فهمد!</p>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
            سلام! من BK AI هستم، یک چت‌بات هوشمند. چطور می‌تونم کمکتون کنم؟
            <div class="message-time">همین الان</div>
        </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="userInput" placeholder="پیام خود را بنویسید..." autocomplete="off">
        <button id="sendBtn">ارسال</button>
    </div>

    <script>
        // ====== سیستم درک زبان طبیعی ساده ======
        class SimpleNLP {
            constructor() {
                this.patterns = this.initializePatterns();
                this.context = {};
            }
            
            initializePatterns() {
                return [
                    // الگوهای سلام و احوالپرسی
                    {
                        pattern: /(سلام|درود|هی|صبح بخیر|عصر بخیر|شب بخیر)/i,
                        category: "greeting",
                        responses: [
                            "سلام! چطور می‌تونم کمک کنم؟",
                            "درود بر شما! حالتون چطوره؟",
                            "سلام! خوشحالم که باهات صحبت می‌کنم.",
                            "هی! چه خبر؟ چطور می‌تونم کمکت کنم؟"
                        ]
                    },
                    // الگوهای تشکر
                    {
                        pattern: /(ممنون|مرسی|تشکر|دست مریزاد|ممنونم|باتشکر)/i,
                        category: "thanks",
                        responses: [
                            "خواهش می‌کنم!",
                            "قابلی نداشت!",
                            "خوشحالم که تونستم کمک کنم!",
                            "همیشه در خدمت شما هستم!"
                        ]
                    },
                    // الگوهای پرسش درباره خود ربات
                    {
                        pattern: /(تو کیستی|اسم تو چیه|تو چی هستی|تو چیست|你是谁|what are you|who are you)/i,
                        category: "about_bot",
                        responses: [
                            "من BK AI هستم، یک چت‌بات هوشمند که برای کمک به شما طراحی شده‌ام.",
                            "اسم من BK AI هست. من یک دستیار هوشمندم که می‌تونم باهات صحبت کنم و کمکت کنم.",
                            "من یک هوش مصنوعی هستم که می‌تونم به سوالات شما پاسخ بدم و باهات گفتگو کنم."
                        ]
                    },
                    // الگوهای پرسش درباره نام کاربر
                    {
                        pattern: /(اسمم|نامم|من .+ هستم|اسم من|my name is|I am)/i,
                        category: "user_name",
                        responses: [
                            "چه اسم قشنگی! خوشحالم که باهات آشنا شدم.",
                            "اسم خوبی داری! خوش اومدی.",
                            "چه اسم زیبایی! خوشحالم که باهات صحبت می‌کنم."
                        ],
                        extractor: (message) => {
                            const matches = message.match(/(اسمم|نامم|من) (.+) (هستم|است|am|is)/i);
                            return matches ? matches[2] : null;
                        }
                    },
                    // الگوهای پرسش درباره زمان
                    {
                        pattern: /(ساعت چنده|وقت چنده|几点了|what time|what is the time)/i,
                        category: "time",
                        responses: [
                            "همین الان ساعت {{time}} هست.",
                            "الان ساعت {{time}} هست.",
                            "ساعت {{time}} هست."
                        ]
                    },
                    // الگوهای پرسش درباره تاریخ
                    {
                        pattern: /(امروز چندمه|تاریخ امروز|今天是|what date|what is the date)/i,
                        category: "date",
                        responses: [
                            "امروز {{date}} هست.",
                            "الان {{date}} هست.",
                            "تاریخ امروز: {{date}}"
                        ]
                    },
                    // الگوهای خداحافظی
                    {
                        pattern: /(خداحافظ|بای|خدانگهدار|bye|goodbye|see you)/i,
                        category: "goodbye",
                        responses: [
                            "خداحافظ! امیدوارم بازم ببینمت.",
                            "بای! روز خوبی داشته باشی.",
                            "خدانگهدار! همیشه سلامت باشی."
                        ]
                    },
                    // الگوهای سوالات عمومی
                    {
                        pattern: /(چطور|چگونه|چرا|چی|چه|کی|کجا|چند|how|why|what|when|where|which|who)/i,
                        category: "question",
                        responses: [
                            "سوال جالبی پرسیدی. فکر می‌کنم جوابش این باشه که...",
                            "خب، این بستگی به عوامل مختلفی داره...",
                            "از دیدگاه من، میشه اینطور看待 کرد که...",
                            "به نظر من، این موضوع رو میشه از چند جنبه مختلف بررسی کرد..."
                        ]
                    },
                    // الگوهای احساسات
                    {
                        pattern: /(خوشحالم|غمگینم|عصبانیم|خستم|استرس دارم|ناراحتم|نگرانم|happy|sad|angry|tired)/i,
                        category: "emotion",
                        responses: [
                            "متوجه احساست میشم. می‌خوای در موردش بیشتر صحبت کنیم؟",
                            "احساساتت رو درک می‌کنم. اگر دوست داری، می‌تونیم بیشتر حرف بزنیم.",
                            "ممنون که احساساتت رو با من در میان گذاشتی. دوست داری بیشتر صحبت کنیم؟"
                        ]
                    }
                ];
            }
            
            understand(message) {
                const lowerMessage = message.toLowerCase();
                
                // بررسی الگوها
                for (const patternObj of this.patterns) {
                    if (patternObj.pattern.test(message)) {
                        const response = this.getResponse(patternObj, message);
                        return {
                            category: patternObj.category,
                            response: response,
                            extractedData: patternObj.extractor ? patternObj.extractor(message) : null
                        };
                    }
                }
                
                // اگر هیچ الگویی匹配 نشد
                return {
                    category: "unknown",
                    response: this.getDefaultResponse(message),
                    extractedData: null
                };
            }
            
            getResponse(patternObj, message) {
                const responses = patternObj.responses;
                const randomIndex = Math.floor(Math.random() * responses.length);
                let response = responses[randomIndex];
                
                // جایگزینی dynamic values
                if (patternObj.category === "time") {
                    const now = new Date();
                    const time = now.toLocaleTimeString('fa-IR');
                    response = response.replace("{{time}}", time);
                } else if (patternObj.category === "date") {
                    const now = new Date();
                    const date = now.toLocaleDateString('fa-IR');
                    response = response.replace("{{date}}", date);
                }
                
                return response;
            }
            
            getDefaultResponse(message) {
                const defaultResponses = [
                    "جالب بود! می‌خوای بیشتر در این مورد صحبت کنیم؟",
                    "منظورت رو کامل متوجه نشدم، میشه کمی بیشتر توضیح بدی؟",
                    "درباره این موضوع مطمئن نیستم، میتونی یه کم بیشتر توضیح بدی؟",
                    "جالب است! دوست داری بیشتر در این مورد صحبت کنیم؟",
                    "می‌تونی سوالت رو به شکل دیگری بپرسی؟ شاید بهتر بتونم کمکت کنم."
                ];
                
                return defaultResponses[Math.floor(Math.random() * defaultResponses.length)];
            }
        }

        // ====== مدیریت چت‌بات ======
        class ChatManager {
            constructor() {
                this.nlp = new SimpleNLP();
                this.setupEventListeners();
                this.loadSettings();
            }
            
            setupEventListeners() {
                const sendBtn = document.getElementById('sendBtn');
                const userInput = document.getElementById('userInput');
                const themeToggle = document.getElementById('themeToggle');
                
                sendBtn.addEventListener('click', () => this.sendMessage());
                userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                themeToggle.addEventListener('click', () => this.toggleTheme());
            }
            
            sendMessage() {
                const userInput = document.getElementById('userInput');
                const message = userInput.value.trim();
                
                if (message === '') return;
                
                this.addMessage(message, 'user');
                userInput.value = '';
                
                this.showTypingIndicator();
                
                // پردازش پیام با تاخیر برای طبیعی‌تر شدن
                setTimeout(() => {
                    this.hideTypingIndicator();
                    this.processMessage(message);
                }, 1000 + Math.random() * 1000);
            }
            
            processMessage(message) {
                const understanding = this.nlp.understand(message);
                
                // اگر نام کاربر استخراج شد، ذخیره کنید
                if (understanding.extractedData) {
                    this.userName = understanding.extractedData;
                }
                
                // شخصی‌سازی پاسخ با نام کاربر
                let response = understanding.response;
                if (this.userName) {
                    response = response.replace(/تو/gi, this.userName);
                }
                
                this.addMessage(response, 'bot');
            }
            
            addMessage(text, type) {
                const chatContainer = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                
                messageDiv.classList.add('message', type === 'user' ? 'user-message' : 'bot-message');
                
                const messageText = document.createElement('div');
                messageText.textContent = text;
                messageDiv.appendChild(messageText);
                
                const messageTime = document.createElement('div');
                messageTime.classList.add('message-time');
                messageTime.textContent = new Date().toLocaleTimeString('fa-IR');
                messageDiv.appendChild(messageTime);
                
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            showTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'block';
            }
            
            hideTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'none';
            }
            
            toggleTheme() {
                document.body.classList.toggle('dark-mode');
                const themeToggle = document.getElementById('themeToggle');
                themeToggle.textContent = document.body.classList.contains('dark-mode') ? '☀️' : '🌙';
                
                // ذخیره تم در localStorage
                localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            }
            
            loadSettings() {
                // بارگذاری تم از localStorage
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeToggle').textContent = '☀️';
                }
            }
        }

        // راه‌اندازی چت‌بات هنگامی که صفحه بارگذاری شد
        document.addEventListener('DOMContentLoaded', () => {
            window.chatManager = new ChatManager();
        });
    </script>
</body>
</html>
