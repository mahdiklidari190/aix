<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ú¯ÙØªÚ¯ÙˆÛŒ ÙØ§Ø±Ø³ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        header {
            background: linear-gradient(90deg, #4e54c8 0%, #8f94fb 100%);
            color: white;
            padding: 25px;
            text-align: center;
        }
        .chat-container {
            padding: 20px;
            height: 500px;
            overflow-y: auto;
            background: #f9f9f9;
        }
        .message {
            margin-bottom: 15px;
            display: flex;
        }
        .user-message {
            justify-content: flex-end;
        }
        .ai-message {
            justify-content: flex-start;
        }
        .message-content {
            max-width: 70%;
            padding: 12px 18px;
            border-radius: 18px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .user-message .message-content {
            background: #e3f2fd;
            border-top-right-radius: 5px;
        }
        .ai-message .message-content {
            background: #f5f5f5;
            border-top-left-radius: 5px;
        }
        .input-area {
            padding: 20px;
            background: white;
            border-top: 1px solid #eee;
        }
        input {
            width: calc(100% - 120px);
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 16px;
        }
        button {
            background: #4e54c8;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin-right: 10px;
        }
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ú¯ÙØªÚ¯ÙˆÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ÙØ§Ø±Ø³ÛŒ</h1>
            <p>Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¯Ø±Ú© Ùˆ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ú¯ÙØªÚ¯ÙˆÛŒ Ø§Ù†Ø³Ø§Ù†ÛŒ</p>
        </header>
        
        <div class="chat-container" id="chat-box">
            <div class="message ai-message">
                <div class="message-content">
                    <p>Ø³Ù„Ø§Ù…! Ù…Ù† ÛŒÚ© Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÙØ§Ø±Ø³ÛŒ Ù‡Ø³ØªÙ…. Ú†Ú¯ÙˆÙ†Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ú©Ù†Ù…ØŸ</p>
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="user-input" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
            <button onclick="sendMessage()">Ø§Ø±Ø³Ø§Ù„</button>
        </div>
    </div>

    <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.18.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@1.3.3"></script>
    <script src="https://cdn.jsdelivr.net/npm/brain.js@2.0.0-beta/dist/browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/compromise/14.0.0/compromise.min.js"></script>
    
    <script>
        // Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø¯Ø§Ù†Ø´ Ùˆ Ø­Ø§ÙØ¸Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        class PersianAIMemory {
            constructor() {
                this.conversations = new Map();
                this.knowledgeBase = {
                    greetings: ['Ø³Ù„Ø§Ù…', 'Ø¯Ø±ÙˆØ¯', 'Ø³Ù„Ø§Ù…ØªÛŒ', 'Ø¹Ù„ÛŒÚ©', 'hello', 'hi'],
                    farewells: ['Ø®Ø¯Ø§Ø­Ø§ÙØ¸', 'Ø¨Ø§ÛŒ', 'Ø®Ø¯Ø§Ù†Ú¯Ù‡Ø¯Ø§Ø±', 'goodbye', 'bye'],
                    questions: ['Ú†Ø·ÙˆØ±', 'Ú†Ú¯ÙˆÙ†Ù‡', 'Ú†Ø±Ø§', 'Ú©ÛŒ', 'Ú©Ø¬Ø§', 'Ú†Ù‡', 'Ú†Ù‚Ø¯'],
                    emotions: {
                        positive: ['Ø®ÙˆØ´Ø­Ø§Ù„', 'Ø¹Ø§Ù„ÛŒ', 'ÙÙˆÙ‚Ø§Ù„Ø¹Ø§Ø¯Ù‡', 'Ù…Ù…Ù†ÙˆÙ†', 'Ù…ØªØ´Ú©Ø±'],
                        negative: ['Ù†Ø§Ø±Ø§Ø­Øª', 'ØºÙ…Ú¯ÛŒÙ†', 'Ø¹ØµØ¨Ø§Ù†ÛŒ', 'Ø¨Ø¯', 'Ø¶Ø¹ÛŒÙ']
                    }
                };
                
                this.patterns = {
                    math: /\d+[\+\-\*\/]\d+/,
                    question: /(Ú†Ø·ÙˆØ±|Ú†Ú¯ÙˆÙ†Ù‡|Ú†Ø±Ø§|Ú©ÛŒ|Ú©Ø¬Ø§|Ú†Ù‡|Ú†Ù‚Ø¯)/,
                    greeting: /(Ø³Ù„Ø§Ù…|Ø¯Ø±ÙˆØ¯|Ø³Ù„Ø§Ù…ØªÛŒ|Ø¹Ù„ÛŒÚ©)/,
                    farewell: /(Ø®Ø¯Ø§Ø­Ø§ÙØ¸|Ø¨Ø§ÛŒ|Ø®Ø¯Ø§Ù†Ú¯Ù‡Ø¯Ø§Ø±)/
                };
            }
            
            // ØªØ­Ù„ÛŒÙ„ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ
            analyzeSentiment(text) {
                const words = text.split(' ');
                let score = 0;
                
                words.forEach(word => {
                    if (this.knowledgeBase.emotions.positive.includes(word)) score++;
                    if (this.knowledgeBase.emotions.negative.includes(word)) score--;
                });
                
                return score > 0 ? 'positive' : score < 0 ? 'negative' : 'neutral';
            }
            
            // ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù…
            detectIntent(text) {
                if (this.patterns.math.test(text)) return 'math';
                if (this.patterns.question.test(text)) return 'question';
                if (this.patterns.greeting.test(text)) return 'greeting';
                if (this.patterns.farewell.test(text)) return 'farewell';
                return 'general';
            }
            
            // Ø°Ø®ÛŒØ±Ù‡ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡
            saveConversation(sessionId, message, response) {
                if (!this.conversations.has(sessionId)) {
                    this.conversations.set(sessionId, []);
                }
                this.conversations.get(sessionId).push({
                    message,
                    response,
                    timestamp: Date.now()
                });
            }
        }

        // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ ÙØ§Ø±Ø³ÛŒ
        class PersianNLP {
            constructor() {
                this.sentimentModel = null;
                this.encoder = null;
                this.init();
            }
            
            async init() {
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù„Ø§Ø²Ù…
                try {
                    this.encoder = await use.load();
                    console.log('Ù…Ø¯Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯');
                } catch (error) {
                    console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù…Ø¯Ù„:', error);
                }
            }
            
            // ØªØ¬Ø²ÛŒÙ‡ Ùˆ ØªØ­Ù„ÛŒÙ„ Ù…ØªÙ† ÙØ§Ø±Ø³ÛŒ
            async analyze(text) {
                const embeddings = await this.encoder.embed([text]);
                const embeddingArray = await embeddings.array();
                
                return {
                    embedding: embeddingArray[0],
                    tokens: this.tokenize(text),
                    sentiment: this.analyzeSentiment(text),
                    entities: this.extractEntities(text)
                };
            }
            
            // ØªØ¬Ø²ÛŒÙ‡ Ù…ØªÙ† Ø¨Ù‡ ØªÙˆÚ©Ù†â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ
            tokenize(text) {
                return text.split(/\s+/).filter(token => token.length > 0);
            }
            
            // ØªØ­Ù„ÛŒÙ„ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ù…ØªÙ†
            analyzeSentiment(text) {
                const positiveWords = ['Ø®ÙˆØ¨', 'Ø¹Ø§Ù„ÛŒ', 'Ù…Ù…ØªØ§Ø²', 'Ø¹Ø§Ù„ÛŒ', 'ÙÙˆÙ‚Ø§Ù„Ø¹Ø§Ø¯Ù‡'];
                const negativeWords = ['Ø¨Ø¯', 'Ø¶Ø¹ÛŒÙ', 'Ø¨ÛŒâ€ŒÚ©ÛŒÙÛŒØª', 'Ù…Ø´Ú©Ù„', 'Ø®Ø·Ø§'];
                
                let positiveCount = 0;
                let negativeCount = 0;
                
                positiveWords.forEach(word => {
                    if (text.includes(word)) positiveCount++;
                });
                
                negativeWords.forEach(word => {
                    if (text.includes(word)) negativeCount++;
                });
                
                return positiveCount > negativeCount ? 'positive' : 
                       negativeCount > positiveCount ? 'negative' : 'neutral';
            }
            
            // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙˆØ¬ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù†Ø§Ù…Ø¯Ø§Ø± Ø§Ø² Ù…ØªÙ†
            extractEntities(text) {
                const doc = nlp(text);
                return {
                    people: doc.people().out('array'),
                    places: doc.places().out('array'),
                    organizations: doc.organizations().out('array')
                };
            }
        }

        // Ø´Ø¨Ú©Ù‡ Ø¹ØµØ¨ÛŒ Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®
        class NeuralResponseGenerator {
            constructor() {
                this.net = new brain.recurrent.LSTM();
                this.trainingData = [];
                this.isTrained = false;
            }
            
            // Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¯Ù„ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ
            async train() {
                const trainingData = [
                    { input: 'Ø³Ù„Ø§Ù…', output: 'Ø³Ù„Ø§Ù…! Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ú©Ù…Ú© Ú©Ù†Ù…ØŸ' },
                    { input: 'Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡', output: 'Ù…Ù† ÛŒÚ© Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù‡Ø³ØªÙ…ØŒ Ø§Ù…Ø§ Ù…Ù…Ù†ÙˆÙ† Ú©Ù‡ Ù¾Ø±Ø³ÛŒØ¯ÛŒ! Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¨Ù‡ Ø´Ù…Ø§ Ú©Ù…Ú© Ú©Ù†Ù…ØŸ' },
                    { input: 'Ø§Ø³Ù… ØªÙˆ Ú†ÛŒØ³Øª', output: 'Ù…Ù† ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÙØ§Ø±Ø³ÛŒ Ù‡Ø³ØªÙ…. Ø´Ù…Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù‡Ø± Ù†Ø§Ù…ÛŒ Ú©Ù‡ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒÙ… Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯!' },
                    { input: 'Ú†Ù‡ Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒ', output: 'Ù…Ù† Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ø¯Ø± Ù…ÙˆØ¶ÙˆØ¹Ø§Øª Ù…Ø®ØªÙ„Ù Ú¯ÙØªÚ¯Ùˆ Ú©Ù†Ù…ØŒ Ø³ÙˆØ§Ù„Ø§Øª Ø´Ù…Ø§ Ø±Ø§ Ù¾Ø§Ø³Ø® Ø¯Ù‡Ù…ØŒ Ø¯Ø± Ø­Ù„ Ù…Ø³Ø§Ø¦Ù„ Ø±ÛŒØ§Ø¶ÛŒ Ú©Ù…Ú© Ú©Ù†Ù… Ùˆ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù…ÙÛŒØ¯ Ø§Ø±Ø§Ø¦Ù‡ Ø¯Ù‡Ù….' },
                    { input: 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸', output: 'Ø®Ø¯Ø§Ø­Ø§ÙØ¸! Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ… Ø§Ú¯Ø± Ø¨Ø§Ø² Ù‡Ù… Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø´ØªÛŒØ¯.' },
                    { input: 'Ù…ØªØ´Ú©Ø±Ù…', output: 'Ø®ÙˆØ§Ù‡Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù…! Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø®Ø¯Ù…Øª Ø´Ù…Ø§ Ù‡Ø³ØªÙ….' }
                ];
                
                this.trainingData = trainingData;
                
                // Ø¢Ù…ÙˆØ²Ø´ Ø´Ø¨Ú©Ù‡ Ø¹ØµØ¨ÛŒ
                this.net.train(trainingData, {
                    iterations: 2000,
                    log: true,
                    logPeriod: 100,
                    learningRate: 0.01
                });
                
                this.isTrained = true;
                console.log('Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¯Ù„ Ø¨Ù‡ Ù¾Ø§ÛŒØ§Ù† Ø±Ø³ÛŒØ¯');
            }
            
            // ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ø¨Ø± Ø§Ø³Ø§Ø³ ÙˆØ±ÙˆØ¯ÛŒ
            generateResponse(input) {
                if (!this.isTrained) {
                    return 'Ù„Ø·ÙØ§Ù‹ Ú©Ù…ÛŒ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ØŒ Ù…Ø¯Ù„ Ø¯Ø± Ø­Ø§Ù„ Ø¢Ù…ÙˆØ²Ø´ Ø§Ø³Øª...';
                }
                
                return this.net.run(input);
            }
            
            // Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø§Ø¯Ù‡ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¬Ø¯ÛŒØ¯
            addTrainingData(input, output) {
                this.trainingData.push({ input, output });
                this.train(); // Ø¢Ù…ÙˆØ²Ø´ Ù…Ø¬Ø¯Ø¯ Ø¨Ø§ Ø¯Ø§Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯
            }
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ú¯ÙØªÚ¯Ùˆ Ùˆ context
        class ConversationManager {
            constructor() {
                this.context = {
                    currentTopic: '',
                    userPreferences: {},
                    conversationHistory: [],
                    userMood: 'neutral'
                };
            }
            
            updateContext(userInput, aiResponse, sentiment) {
                this.context.conversationHistory.push({
                    user: userInput,
                    ai: aiResponse,
                    timestamp: Date.now(),
                    sentiment: sentiment
                });
                
                // Ø­ÙØ¸ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø¯Ø± Ù…Ø­Ø¯ÙˆØ¯Ù‡ Ù…Ø¹Ù‚ÙˆÙ„
                if (this.context.conversationHistory.length > 50) {
                    this.context.conversationHistory.shift();
                }
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø­Ø§Ù„Øª Ú©Ø§Ø±Ø¨Ø±
                this.context.userMood = sentiment;
                
                // ØªØ´Ø®ÛŒØµ Ù…ÙˆØ¶ÙˆØ¹ Ù…Ú©Ø§Ù„Ù…Ù‡
                this.detectTopic(userInput);
            }
            
            detectTopic(userInput) {
                const topics = {
                    Ø±ÛŒØ§Ø¶ÛŒ: ['Ù…Ø­Ø§Ø³Ø¨Ù‡', 'Ø±ÛŒØ§Ø¶ÛŒ', 'Ø¬Ù…Ø¹', 'ØªÙØ±ÛŒÙ‚', 'Ø¶Ø±Ø¨', 'ØªÙ‚Ø³ÛŒÙ…'],
                    ÙÙ†Ø§ÙˆØ±ÛŒ: ['Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±', 'Ù…ÙˆØ¨Ø§ÛŒÙ„', 'Ø¨Ø±Ù†Ø§Ù…Ù‡', 'Ù†Ø±Ù…â€ŒØ§ÙØ²Ø§Ø±', 'Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ'],
                    Ø¹Ù„Ù…ÛŒ: ['Ø¹Ù„Ù…', 'ØªØ­Ù‚ÛŒÙ‚', 'Ø¯Ø§Ù†Ø´', 'Ú©Ø´Ù'],
                    ÙˆØ±Ø²Ø´: ['ÙˆØ±Ø²Ø´', 'ÙÙˆØªØ¨Ø§Ù„', 'ÙˆØ§Ù„ÛŒØ¨Ø§Ù„', 'Ù…Ø³Ø§Ø¨Ù‚Ù‡']
                };
                
                for (const [topic, keywords] of Object.entries(topics)) {
                    if (keywords.some(keyword => userInput.includes(keyword))) {
                        this.context.currentTopic = topic;
                        return;
                    }
                }
            }
            
            getContextualResponse(userInput) {
                const lastMessages = this.context.conversationHistory.slice(-3);
                const context = lastMessages.map(msg => msg.user + ' ' + msg.ai).join(' ');
                
                return {
                    context,
                    shouldContinueTopic: this.shouldContinueTopic(userInput),
                    userMood: this.context.userMood
                };
            }
            
            shouldContinueTopic(userInput) {
                if (!this.context.currentTopic) return false;
                
                const topicKeywords = {
                    Ø±ÛŒØ§Ø¶ÛŒ: ['Ù…Ø­Ø§Ø³Ø¨Ù‡', 'Ø±ÛŒØ§Ø¶ÛŒ', 'Ø¹Ø¯Ø¯'],
                    ÙÙ†Ø§ÙˆØ±ÛŒ: ['Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±', 'Ø¨Ø±Ù†Ø§Ù…Ù‡', 'ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ'],
                    Ø¹Ù„Ù…ÛŒ: ['ØªØ­Ù‚ÛŒÙ‚', 'Ø¯Ø§Ù†Ø´', 'Ú©Ø´Ù'],
                    ÙˆØ±Ø²Ø´: ['ÙˆØ±Ø²Ø´', 'Ø¨Ø±Ù†Ø¯Ù‡', 'Ø¨Ø§Ø²ÛŒ']
                };
                
                const keywords = topicKeywords[this.context.currentTopic] || [];
                return keywords.some(keyword => userInput.includes(keyword));
            }
        }

        // Ú©Ù„Ø§Ø³ Ø§ØµÙ„ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        class PersianAI {
            constructor() {
                this.memory = new PersianAIMemory();
                this.nlp = new PersianNLP();
                this.responseGenerator = new NeuralResponseGenerator();
                this.conversationManager = new ConversationManager();
                this.sessionId = this.generateSessionId();
                
                this.init();
            }
            
            async init() {
                console.log('Ø¯Ø± Ø­Ø§Ù„ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÙØ§Ø±Ø³ÛŒ...');
                await this.responseGenerator.train();
                console.log('Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¢Ù…Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª');
            }
            
            generateSessionId() {
                return 'session_' + Math.random().toString(36).substr(2, 9);
            }
            
            // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø± Ùˆ ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®
            async processMessage(userInput) {
                // ØªØ­Ù„ÛŒÙ„ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø±
                const analysis = await this.nlp.analyze(userInput);
                const intent = this.memory.detectIntent(userInput);
                const sentiment = this.memory.analyzeSentiment(userInput);
                
                // Ø¯Ø±ÛŒØ§ÙØª context Ù…Ú©Ø§Ù„Ù…Ù‡
                const context = this.conversationManager.getContextualResponse(userInput);
                
                // ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ø¨Ø± Ø§Ø³Ø§Ø³ Ù‚ØµØ¯ Ú©Ø§Ø±Ø¨Ø±
                let response;
                
                switch (intent) {
                    case 'math':
                        response = this.handleMathQuery(userInput);
                        break;
                    case 'greeting':
                        response = this.handleGreeting();
                        break;
                    case 'farewell':
                        response = this.handleFarewell();
                        break;
                    case 'question':
                        response = await this.handleQuestion(userInput, context);
                        break;
                    default:
                        response = this.responseGenerator.generateResponse(userInput);
                }
                
                // ØªØ·Ø¨ÛŒÙ‚ Ù¾Ø§Ø³Ø® Ø¨Ø§ Ø­Ø§Ù„Øª Ø§Ø­Ø³Ø§Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø±
                response = this.adaptToSentiment(response, sentiment);
                
                // Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ context Ù…Ú©Ø§Ù„Ù…Ù‡
                this.conversationManager.updateContext(userInput, response, sentiment);
                
                // Ø°Ø®ÛŒØ±Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡
                this.memory.saveConversation(this.sessionId, userInput, response);
                
                return response;
            }
            
            // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³ÙˆØ§Ù„Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ
            handleMathQuery(query) {
                try {
                    // Ø­Ø°Ù Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ ØºÛŒØ± Ø¶Ø±ÙˆØ±ÛŒ
                    const mathExpression = query.replace(/[^\d\+\-\*\/\(\)\.]/g, '');
                    
                    if (!mathExpression) {
                        return 'Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ Ù…Ø¹ØªØ¨Ø±ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ú©Ø±Ø¯Ù….';
                    }
                    
                    // Ù…Ø­Ø§Ø³Ø¨Ù‡ Ù†ØªÛŒØ¬Ù‡
                    const result = eval(mathExpression);
                    return `Ù†ØªÛŒØ¬Ù‡ Ù…Ø­Ø§Ø³Ø¨Ù‡ ${mathExpression} = ${result}`;
                } catch (error) {
                    return 'Ù†ØªÙˆØ§Ù†Ø³ØªÙ… Ù…Ø³Ø¦Ù„Ù‡ Ø±ÛŒØ§Ø¶ÛŒ Ø±Ø§ Ø­Ù„ Ú©Ù†Ù…. Ù„Ø·ÙØ§Ù‹ ÛŒÚ© Ø¹Ø¨Ø§Ø±Øª Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.';
                }
            }
            
            // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ
            handleGreeting() {
                const greetings = [
                    'Ø³Ù„Ø§Ù…! Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù… Ú©Ù…Ú© Ú©Ù†Ù…ØŸ',
                    'Ø¯Ø±ÙˆØ¯! Ú†Ù‡ Ú©Ù…Ú©ÛŒ Ø§Ø² Ø¯Ø³ØªÙ… Ø¨Ø±Ù…ÛŒâ€ŒØ¢ÛŒØ¯ØŸ',
                    'Ø³Ù„Ø§Ù… Ø¨Ø± Ø´Ù…Ø§! Ú†Ù‡ Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø±ÛŒØ¯ØŸ',
                    'Ø³Ù„Ø§Ù…! Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ Ø¨Ø§ Ø´Ù…Ø§ Ú¯ÙØªÚ¯Ùˆ Ù…ÛŒâ€ŒÚ©Ù†Ù….'
                ];
                
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø®Ø¯Ø§Ø­Ø§ÙØ¸ÛŒ
            handleFarewell() {
                const farewells = [
                    'Ø®Ø¯Ø§Ø­Ø§ÙØ¸! Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ù… Ø¨Ø§Ø² Ù‡Ù… Ø¨Ø¨ÛŒÙ†Ù…ØªØ§Ù†.',
                    'Ø¨Ø¯Ø±ÙˆØ¯! Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ÛŒ Ø¯Ø§Ø´ØªÛŒØ¯ Ø¯Ø± Ø®Ø¯Ù…ØªÙ….',
                    'Ø®Ø¯Ø§Ù†Ú¯Ù‡Ø¯Ø§Ø±! Ø±ÙˆØ² Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.',
                    'Ø®Ø¯Ø§Ø­Ø§ÙØ¸! Ø§Ø² Ú¯ÙØªÚ¯Ùˆ Ø¨Ø§ Ø´Ù…Ø§ Ù„Ø°Øª Ø¨Ø±Ø¯Ù….'
                ];
                
                return farewells[Math.floor(Math.random() * farewells.length)];
            }
            
            // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø³ÙˆØ§Ù„Ø§Øª Ø¹Ù…ÙˆÙ…ÛŒ
            async handleQuestion(question, context) {
                // Ø¯Ø± Ø§ÛŒÙ† Ø¨Ø®Ø´ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² APIÙ‡Ø§ÛŒ Ø®Ø§Ø±Ø¬ÛŒ ÛŒØ§ Ø¯Ø§Ù†Ø´ Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø¯Ø§Ø¯Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
                // Ø§ÛŒÙ† ÛŒÚ© Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø§Ø¯Ù‡ Ø§Ø³Øª
                
                const commonQuestions = {
                    'Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§': ['Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§', 'Ù‡ÙˆØ§ Ú†Ø·ÙˆØ±Ù‡', 'Ø¯Ù…Ø§'],
                    'Ø§Ø®Ø¨Ø§Ø±': ['Ø§Ø®Ø¨Ø§Ø±', 'ØªØ§Ø²Ù‡â€ŒÙ‡Ø§', 'Ø¬Ø¯ÛŒØ¯'],
                    'Ø²Ù…Ø§Ù†': ['Ø³Ø§Ø¹Øª', 'Ø²Ù…Ø§Ù†', 'Ú†Ù†Ø¯ Ø´Ø¨']
                };
                
                // Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„
                for (const [category, keywords] of Object.entries(commonQuestions)) {
                    if (keywords.some(keyword => question.includes(keyword))) {
                        return this.answerCommonQuestion(category, question);
                    }
                }
                
                // Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ Ø®Ø§ØµÛŒ Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ù†Ø´Ø¯ØŒ Ø§Ø² Ø´Ø¨Ú©Ù‡ Ø¹ØµØ¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
                return this.responseGenerator.generateResponse(question);
            }
            
            answerCommonQuestion(category, question) {
                const responses = {
                    'Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§': 'Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø¨Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ÛŒÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù†Ø¯Ø§Ø±Ù…. Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¢Ø¨ Ùˆ Ù‡ÙˆØ§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.',
                    'Ø§Ø®Ø¨Ø§Ø±': 'Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø®Ø¨Ø§Ø± Ø¨Ù‡ Ø±ÙˆØ²ØŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒÚ©Ù†Ù… Ø¨Ù‡ Ø³Ø§ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ø®Ø¨Ø±ÛŒ Ù…Ø¹ØªØ¨Ø± Ù…Ø±Ø§Ø¬Ø¹Ù‡ Ú©Ù†ÛŒØ¯.',
                    'Ø²Ù…Ø§Ù†': `Ù‡Ù… Ø§Ú©Ù†ÙˆÙ† Ø³Ø§Ø¹Øª ${new Date().toLocaleTimeString('fa-IR')} Ø§Ø³Øª.`
                };
                
                return responses[category] || 'Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§ØªÛŒ Ø¯Ø± Ø§ÛŒÙ† Ø²Ù…ÛŒÙ†Ù‡ Ù†Ø¯Ø§Ø±Ù….';
            }
            
            // ØªØ·Ø¨ÛŒÙ‚ Ù¾Ø§Ø³Ø® Ø¨Ø§ Ø­Ø§Ù„Øª Ø§Ø­Ø³Ø§Ø³ÛŒ Ú©Ø§Ø±Ø¨Ø±
            adaptToSentiment(response, sentiment) {
                if (sentiment === 'positive') {
                    return response + ' ğŸ˜Š';
                } else if (sentiment === 'negative') {
                    return response + ' Ø§Ù…ÛŒØ¯ÙˆØ§Ø±Ù… Ø­Ø§Ù„ØªØ§Ù† Ø¨Ù‡ØªØ± Ø´ÙˆØ¯.';
                }
                return response;
            }
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
        const persianAI = new PersianAI();

        // Ù…Ø¯ÛŒØ±ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø§Ø² Ø·Ø±ÛŒÙ‚ Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ
        async function sendMessage() {
            const userInput = document.getElementById('user-input').value;
            if (!userInput.trim()) return;
            
            // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ú©Ø§Ø±Ø¨Ø±
            displayMessage(userInput, 'user');
            document.getElementById('user-input').value = '';
            
            // Ù†Ù…Ø§ÛŒØ´ Ø­Ø§Ù„Øª Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message ai-message';
            loadingDiv.innerHTML = '<div class="message-content"><p class="loading">Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´...</p></div>';
            document.getElementById('chat-box').appendChild(loadingDiv);
            document.getElementById('chat-box').scrollTop = document.getElementById('chat-box').scrollHeight;
            
            try {
                // Ø¯Ø±ÛŒØ§ÙØª Ù¾Ø§Ø³Ø® Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
                const response = await persianAI.processMessage(userInput);
                
                // Ø­Ø°Ù Ø­Ø§Ù„Øª Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ùˆ Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®
                document.getElementById('chat-box').removeChild(loadingDiv);
                displayMessage(response, 'ai');
            } catch (error) {
                document.getElementById('chat-box').removeChild(loadingDiv);
                displayMessage('Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø¯Ø± Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù… Ø´Ù…Ø§ Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.', 'ai');
                console.error('Error:', error);
            }
        }

        // Ù†Ù…Ø§ÛŒØ´ Ù¾ÛŒØ§Ù… Ø¯Ø± Ú†Øª
        function displayMessage(text, sender) {
            const chatBox = document.getElementById('chat-box');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            messageContent.innerHTML = `<p>${text}</p>`;
            
            messageDiv.appendChild(messageContent);
            chatBox.appendChild(messageDiv);
            
            // Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ù‡ Ù¾Ø§ÛŒÛŒÙ†
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        // Ø§Ù…Ú©Ø§Ù† Ø§Ø±Ø³Ø§Ù„ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Enter
        document.getElementById('user-input').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
