<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú†Øªâ€ŒØ¨Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ BK AI+</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
            --user-message-bg: #e3f2fd;
            --bot-message-bg: #f1f0f0;
            --math-message-bg: #e8f5e9;
            --font-family: "Vazirmatn", "Tanha", "Segoe UI", Tahoma, sans-serif;
            --text-color: #333;
            --border-color: #ddd;
        }

        .dark-mode {
            --primary-color: #5a7fb5;
            --secondary-color: #8b9cb0;
            --background-color: #1a1a1a;
            --user-message-bg: #2a4b7c;
            --bot-message-bg: #3a3a3a;
            --math-message-bg: #2d4a2d;
            --text-color: #f0f0f0;
            --border-color: #444;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: 1rem;
            animation: fadeIn 0.3s ease;
            position: relative;
            border: 1px solid var(--border-color);
            line-height: 1.6;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: var(--user-message-bg);
            border-bottom-right-radius: 0.25rem;
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            border-bottom-left-radius: 0.25rem;
        }
        
        .math-message {
            align-self: flex-start;
            background-color: var(--math-message-bg);
            border-bottom-left-radius: 0.25rem;
            border-left: 4px solid #4caf50;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--secondary-color);
            margin-top: 0.25rem;
            text-align: right;
        }
        
        .input-container {
            display: flex;
            padding: 1rem;
            background-color: var(--bot-message-bg);
            border-top: 1px solid var(--border-color);
        }
        
        #userInput {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 1.5rem;
            font-family: var(--font-family);
            outline: none;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        #sendBtn {
            margin-right: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #sendBtn:hover {
            background-color: #3a5a80;
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            padding: 0.75rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }
        
        .typing-dot {
            width: 0.5rem;
            height: 0.5rem;
            background-color: var(--secondary-color);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .settings-btn {
            position: absolute;
            left: 1rem;
            top: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }

        .theme-toggle {
            position: absolute;
            right: 1rem;
            top: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }
        
        .math-expression {
            font-family: monospace;
            background-color: rgba(0, 0, 0, 0.05);
            padding: 0.2rem 0.5rem;
            border-radius: 0.3rem;
            direction: ltr;
            display: inline-block;
            margin: 0 0.2rem;
        }
        
        .math-result {
            font-weight: bold;
            color: #2e7d32;
            direction: ltr;
            display: inline-block;
        }
        
        .dark-mode .math-expression {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .dark-mode .math-result {
            color: #81c784;
        }
    </style>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
</head>
<body>
    <div class="header">
        <button class="settings-btn">âš™ï¸</button>
        <button class="theme-toggle" id="themeToggle">ğŸŒ™</button>
        <h1>Ú†Øªâ€ŒØ¨Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ BK AI+</h1>
        <p>Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø±Ú© Ú©Ø§Ù…Ù„ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ</p>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
            Ø³Ù„Ø§Ù…! Ù…Ù† BK AI+ Ù‡Ø³ØªÙ…ØŒ ÛŒÚ© Ú†Øªâ€ŒØ¨Ø§Øª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§ Ù‚Ø§Ø¨Ù„ÛŒØª Ø¯Ø±Ú© Ú©Ø§Ù…Ù„ Ùˆ Ù…Ø­Ø§Ø³Ø¨Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ. Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©ØªÙˆÙ† Ú©Ù†Ù…ØŸ
            <div class="message-time">Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù†</div>
        </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="userInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ÛŒØ§ ÛŒÚ© Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø±ÛŒØ§Ø¶ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯..." autocomplete="off">
        <button id="sendBtn">Ø§Ø±Ø³Ø§Ù„</button>
    </div>

    <script>
        // ====== Ø³ÛŒØ³ØªÙ… Ø¯Ø±Ú© Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ Ù¾ÛŒØ´Ø±ÙØªÙ‡ ======
        class AdvancedNLP {
            constructor() {
                this.context = {
                    userName: null,
                    lastTopics: [],
                    userInterests: []
                };
            }
            
            processMessage(message) {
                // Ù¾ÛŒØ´â€ŒÙ¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…
                const preprocessed = this.preprocessMessage(message);
                
                // ØªØ´Ø®ÛŒØµ Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù…
                const messageType = this.detectMessageType(preprocessed);
                
                // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ù¾ÛŒØ§Ù…
                switch(messageType) {
                    case 'math':
                        return this.processMathExpression(preprocessed);
                    case 'greeting':
                        return this.generateResponse('greeting');
                    case 'thanks':
                        return this.generateResponse('thanks');
                    case 'question':
                        return this.answerQuestion(preprocessed);
                    case 'personal':
                        return this.handlePersonalMessage(preprocessed);
                    case 'emotion':
                        return this.handleEmotion(preprocessed);
                    default:
                        return this.generateResponse('default');
                }
            }
            
            preprocessMessage(message) {
                // ØªØ¨Ø¯ÛŒÙ„ Ø§Ø¹Ø¯Ø§Ø¯ ÙØ§Ø±Ø³ÛŒ Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±ÛŒØ§Ø¶ÛŒ
                let processed = message.replace(/[Û°-Û¹]/g, d => 'Û°Û±Û²Û³Û´ÛµÛ¶Û·Û¸Û¹'.indexOf(d));
                
                // Ø­Ø°Ù Ú©Ø§Ø±Ø§Ú©ØªØ±Ù‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
                processed = processed.replace(/[ØŸ?ØŒ,;Ø›]/g, '');
                
                return processed;
            }
            
            detectMessageType(message) {
                const lowerMessage = message.toLowerCase();
                
                // ØªØ´Ø®ÛŒØµ Ø¹Ø¨Ø§Ø±Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ
                if (this.isMathExpression(lowerMessage)) {
                    return 'math';
                }
                
                // ØªØ´Ø®ÛŒØµ Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ
                if (/(Ø³Ù„Ø§Ù…|Ø¯Ø±ÙˆØ¯|Ù‡ÛŒ|ØµØ¨Ø­ Ø¨Ø®ÛŒØ±|Ø¹ØµØ± Ø¨Ø®ÛŒØ±|Ø´Ø¨ Ø¨Ø®ÛŒØ±|hello|hi|hey)/i.test(lowerMessage)) {
                    return 'greeting';
                }
                
                // ØªØ´Ø®ÛŒØµ ØªØ´Ú©Ø±
                if (/(Ù…Ù…Ù†ÙˆÙ†|Ù…Ø±Ø³ÛŒ|ØªØ´Ú©Ø±|Ø¯Ø³Øª Ù…Ø±ÛŒØ²Ø§Ø¯|Ù…Ù…Ù†ÙˆÙ†Ù…|Ø¨Ø§ØªØ´Ú©Ø±|thanks|thank you)/i.test(lowerMessage)) {
                    return 'thanks';
                }
                
                // ØªØ´Ø®ÛŒØµ Ø³ÙˆØ§Ù„
                if (/(Ú†Ø·ÙˆØ±|Ú†Ú¯ÙˆÙ†Ù‡|Ú†Ø±Ø§|Ú†ÛŒ|Ú†Ù‡|Ú©ÛŒ|Ú©Ø¬Ø§|Ú†Ù†Ø¯|how|why|what|when|where|which|who|Ø¢ÛŒØ§)/i.test(lowerMessage)) {
                    return 'question';
                }
                
                // ØªØ´Ø®ÛŒØµ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø´Ø®ØµÛŒ
                if (/(Ø§Ø³Ù…|Ù†Ø§Ù…|Ø³Ù†|Ø´ØºÙ„|ØªØ­ØµÛŒÙ„Ø§Øª|Ø¹Ù„Ø§Ù‚Ù‡|Ø§Ù‡Ù„|Ø²Ù†Ø¯Ú¯ÛŒ|Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡|name|age|job)/i.test(lowerMessage)) {
                    return 'personal';
                }
                
                // ØªØ´Ø®ÛŒØµ Ø§Ø­Ø³Ø§Ø³Ø§Øª
                if (/(Ø®ÙˆØ´Ø­Ø§Ù„Ù…|ØºÙ…Ú¯ÛŒÙ†Ù…|Ø¹ØµØ¨Ø§Ù†ÛŒÙ…|Ø®Ø³ØªÙ…|Ø§Ø³ØªØ±Ø³ Ø¯Ø§Ø±Ù…|Ù†Ø§Ø±Ø§Ø­ØªÙ…|Ù†Ú¯Ø±Ø§Ù†Ù…|Ø®ÙˆØ´Ø­Ø§Ù„|ØºÙ…Ú¯ÛŒÙ†|Ø¹ØµØ¨Ø§Ù†ÛŒ|Ø®Ø³ØªÙ‡|happy|sad|angry|tired)/i.test(lowerMessage)) {
                    return 'emotion';
                }
                
                return 'default';
            }
            
            isMathExpression(message) {
                // ØªØ´Ø®ÛŒØµ Ø¹Ø¨Ø§Ø±Ø§Øª Ø±ÛŒØ§Ø¶ÛŒ Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² regex
                const mathRegex = /(\d+\s*[\+\-\Ã—\Ã·\*\/().]\s*)+\d+/;
                const persianMathRegex = /(Ú†Ù‚Ø¯Ø± Ù…ÛŒØ´Ù‡|Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†|Ø­Ø§ØµÙ„|Ù…Ø³Ø§ÙˆÛŒ|Ø¨Ø±Ø§Ø¨Ø±|Ø¨Ù‡ Ø§Ø¶Ø§ÙÙ‡|Ù…Ù†Ù‡Ø§ÛŒ|Ø¶Ø±Ø¨ Ø¯Ø±|ØªÙ‚Ø³ÛŒÙ… Ø¨Ø±)/;
                
                return mathRegex.test(message) || persianMathRegex.test(message);
            }
            
            processMathExpression(message) {
                try {
                    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ
                    let mathExpr = this.extractMathExpression(message);
                    
                    // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¹Ù…Ù„Ú¯Ø±Ù‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¨Ø§ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ
                    mathExpr = mathExpr.replace(/Ã—/g, '*')
                                      .replace(/Ã·/g, '/')
                                      .replace(/Ø¨Ù‡ Ø§Ø¶Ø§ÙÙ‡/gi, '+')
                                      .replace(/Ù…Ù†Ù‡Ø§ÛŒ/gi, '-')
                                      .replace(/Ø¶Ø±Ø¨ Ø¯Ø±/gi, '*')
                                      .replace(/ØªÙ‚Ø³ÛŒÙ… Ø¨Ø±/gi, '/');
                    
                    // Ø­Ø°Ù ÙØ¶Ø§Ù‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ
                    mathExpr = mathExpr.replace(/\s+/g, '');
                    
                    // Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ
                    const result = this.safeEval(mathExpr);
                    
                    // ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø®
                    return {
                        type: 'math',
                        expression: mathExpr,
                        result: result,
                        response: `Ø­Ø§ØµÙ„ <span class="math-expression">${mathExpr}</span> Ø¨Ø±Ø§Ø¨Ø± Ø§Ø³Øª Ø¨Ø§ <span class="math-result">${result}</span>`
                    };
                } catch (error) {
                    return {
                        type: 'error',
                        response: 'Ù…ØªØ£Ø³ÙØ§Ù†Ù‡ Ø¯Ø± Ù…Ø­Ø§Ø³Ø¨Ù‡ Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ Ø®Ø·Ø§ÛŒÛŒ Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ Ø¹Ø¨Ø§Ø±Øª Ø±Ø§ Ø¨Ù‡ Ø´Ú©Ù„ Ø¯ÛŒÚ¯Ø±ÛŒ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.'
                    };
                }
            }
            
            extractMathExpression(message) {
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ Ø§Ø² Ù¾ÛŒØ§Ù…
                const mathRegex = /((\d+[\+\-\*\/\(\)].*)|\d+)/;
                const match = message.match(mathRegex);
                
                if (match) {
                    return match[0];
                }
                
                // Ø§Ú¯Ø± Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯ØŒ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ… Ø§Ø² Ù¾ÛŒØ§Ù… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†ÛŒÙ…
                if (message.includes('Ú†Ù‚Ø¯Ø± Ù…ÛŒØ´Ù‡')) {
                    return message.replace('Ú†Ù‚Ø¯Ø± Ù…ÛŒØ´Ù‡', '').trim();
                }
                
                if (message.includes('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†')) {
                    return message.replace('Ù…Ø­Ø§Ø³Ø¨Ù‡ Ú©Ù†', '').trim();
                }
                
                return message;
            }
            
            safeEval(expr) {
                // Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø§ÛŒÙ…Ù† Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ
                try {
                    // Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¹Ù…Ù„Ú¯Ø±Ù‡Ø§ÛŒ ØºÛŒØ±Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯
                    expr = expr.replace(/[^0-9+\-*/().]/g, '');
                    
                    // Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Function Ø¨Ø±Ø§ÛŒ Ø§Ø±Ø²ÛŒØ§Ø¨ÛŒ Ø§ÛŒÙ…Ù†
                    return Function(`"use strict"; return (${expr})`)();
                } catch (error) {
                    throw new Error('Ø¹Ø¨Ø§Ø±Øª Ø±ÛŒØ§Ø¶ÛŒ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª');
                }
            }
            
            generateResponse(type) {
                const responses = {
                    greeting: [
                        "Ø³Ù„Ø§Ù…! Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú© Ú©Ù†Ù…ØŸ",
                        "Ø¯Ø±ÙˆØ¯ Ø¨Ø± Ø´Ù…Ø§! Ø­Ø§Ù„ØªÙˆÙ† Ú†Ø·ÙˆØ±Ù‡ØŸ",
                        "Ø³Ù„Ø§Ù…! Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ Ø¨Ø§Ù‡Ø§Øª ØµØ­Ø¨Øª Ù…ÛŒâ€ŒÚ©Ù†Ù….",
                        "Ù‡ÛŒ! Ú†Ù‡ Ø®Ø¨Ø±ØŸ Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù…ØŸ"
                    ],
                    thanks: [
                        "Ø®ÙˆØ§Ù‡Ø´ Ù…ÛŒâ€ŒÚ©Ù†Ù…!",
                        "Ù‚Ø§Ø¨Ù„ÛŒ Ù†Ø¯Ø§Ø´Øª!",
                        "Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ ØªÙˆÙ†Ø³ØªÙ… Ú©Ù…Ú© Ú©Ù†Ù…!",
                        "Ù‡Ù…ÛŒØ´Ù‡ Ø¯Ø± Ø®Ø¯Ù…Øª Ø´Ù…Ø§ Ù‡Ø³ØªÙ…!",
                        "Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ Ø±Ø§Ø¶ÛŒØªÙˆÙ† Ú©Ø±Ø¯Ù…!"
                    ],
                    default: [
                        "Ø¬Ø§Ù„Ø¨ Ø¨ÙˆØ¯! Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ",
                        "Ù…Ù†Ø¸ÙˆØ±Øª Ø±Ùˆ Ú©Ø§Ù…Ù„ Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù…ØŒ Ù…ÛŒØ´Ù‡ Ú©Ù…ÛŒ Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯ÛŒØŸ",
                        "Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§ÛŒÙ† Ù…ÙˆØ¶ÙˆØ¹ Ù…Ø·Ù…Ø¦Ù† Ù†ÛŒØ³ØªÙ…ØŒ Ù…ÛŒØªÙˆÙ†ÛŒ ÛŒÙ‡ Ú©Ù… Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯ÛŒØŸ",
                        "Ø¬Ø§Ù„Ø¨ Ø§Ø³Øª! Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø± Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ",
                        "Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø³ÙˆØ§Ù„Øª Ø±Ùˆ Ø¨Ù‡ Ø´Ú©Ù„ Ø¯ÛŒÚ¯Ø±ÛŒ Ø¨Ù¾Ø±Ø³ÛŒØŸ Ø´Ø§ÛŒØ¯ Ø¨Ù‡ØªØ± Ø¨ØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù…."
                    ]
                };
                
                const responseList = responses[type] || responses.default;
                return {
                    type: type,
                    response: responseList[Math.floor(Math.random() * responseList.length)]
                };
            }
            
            answerQuestion(question) {
                // Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ù…ØªØ¯Ø§ÙˆÙ„
                const lowerQuestion = question.toLowerCase();
                
                if (/(Ú†Ø·ÙˆØ±|Ú†Ú¯ÙˆÙ†Ù‡)/i.test(lowerQuestion)) {
                    return {
                        type: 'question',
                        response: "Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø³ÙˆØ§Ù„ØŒ Ø¨Ø§ÛŒØ¯ Ø¨Ú¯Ù… Ú©Ù‡ Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„ÙÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù‡. Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ú©Ù…ÛŒ Ø¨ÛŒØ´ØªØ± ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯ÛŒ ØªØ§ Ø¨ØªÙˆÙ†Ù… Ø¨Ù‡ØªØ± Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒÛŒâ€ŒØª Ú©Ù†Ù…ØŸ"
                    };
                }
                
                if (/(Ú†Ø±Ø§)/i.test(lowerQuestion)) {
                    return {
                        type: 'question',
                        response: "Ø¯Ù„Ø§ÛŒÙ„ Ù…Ø®ØªÙ„ÙÛŒ Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡. Ø´Ø§ÛŒØ¯ Ø¨ØªÙˆÙ†Ù… Ø¨Ø§ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒ Ú©Ù‡ Ø¨Ù‡Ù… Ù…ÛŒØ¯ÛŒØŒ Ù¾Ø§Ø³Ø® Ø¨Ù‡ØªØ±ÛŒ Ø¨Ø±Ø§Øªæä¾› Ú©Ù†Ù…."
                    };
                }
                
                if (/(Ú©ÛŒ|Ú†Ù‡ Ø²Ù…Ø§Ù†ÛŒ)/i.test(lowerQuestion)) {
                    return {
                        type: 'question',
                        response: "Ø²Ù…Ø§Ù†Ø´ Ø¨Ø³ØªÚ¯ÛŒ Ø¨Ù‡ Ø¹ÙˆØ§Ù…Ù„ Ù…Ø®ØªÙ„ÙÛŒ Ø¯Ø§Ø±Ù‡. Ø§Ú¯Ø± Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±ÛŒæä¾› Ú©Ù†ÛŒØŒ Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¯Ù‚ÛŒÙ‚â€ŒØªØ± Ú©Ù…Ú©Øª Ú©Ù†Ù…."
                    };
                }
                
                return this.generateResponse('default');
            }
            
            handlePersonalMessage(message) {
                const lowerMessage = message.toLowerCase();
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±
                if (/(Ø§Ø³Ù…Ù…|Ù†Ø§Ù…Ù…|Ù…Ù† .+ Ù‡Ø³ØªÙ…|Ø§Ø³Ù… Ù…Ù†|my name is|I am)/i.test(lowerMessage)) {
                    const nameMatch = message.match(/(Ø§Ø³Ù…Ù…|Ù†Ø§Ù…Ù…|Ù…Ù†) (.+) (Ù‡Ø³ØªÙ…|Ø§Ø³Øª|am|is)/i);
                    if (nameMatch && nameMatch[2]) {
                        this.context.userName = nameMatch[2];
                        return {
                            type: 'personal',
                            response: `Ú†Ù‡ Ø§Ø³Ù… Ù‚Ø´Ù†Ú¯ÛŒ! ${this.context.userName} Ø¹Ø²ÛŒØ²ØŒ Ø®ÙˆØ´Ø­Ø§Ù„Ù… Ú©Ù‡ Ø¨Ø§Ù‡Ø§Øª Ø¢Ø´Ù†Ø§ Ø´Ø¯Ù….`
                        };
                    }
                }
                
                // Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª Ø´Ø®ØµÛŒ
                if (/(Ú†Ù†Ø¯ Ø³Ø§Ù„ØªÙ‡|Ø³Ù† ØªÙˆ|age)/i.test(lowerMessage)) {
                    return {
                        type: 'personal',
                        response: "Ù…Ù† ÛŒÚ© Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù‡Ø³ØªÙ…ØŒ Ø¨Ù†Ø§Ø¨Ø±Ø§ÛŒÙ† Ø³Ù† Ø¨Ù‡ Ù…Ø¹Ù†ÛŒ Ø³Ù† Ø§Ù†Ø³Ø§Ù†â€ŒÙ‡Ø§ Ø±Ùˆ Ù†Ø¯Ø§Ø±Ù…. Ø§Ù…Ø§ Ø§Ø² Ø²Ù…Ø§Ù†ÛŒ Ú©Ù‡ Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯Ù…ØŒ Ù…Ø¯ØªÛŒ Ù…ÛŒâ€ŒÚ¯Ø°Ø±Ù‡!"
                    };
                }
                
                if (/(Ú©Ø¬Ø§ÛŒÛŒ|Ø§Ù‡Ù„ Ú©Ø¬Ø§|where are you)/i.test(lowerMessage)) {
                    return {
                        type: 'personal',
                        response: "Ù…Ù† Ø¯Ø± ÙØ¶Ø§ÛŒ Ø¯ÛŒØ¬ÛŒØªØ§Ù„ Ø²Ù†Ø¯Ú¯ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù…! Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¯Ø± Ù‡Ø± Ø¬Ø§ÛŒÛŒ Ú©Ù‡ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø¨Ø§Ø´Ù‡ØŒ Ø¯Ø± Ø®Ø¯Ù…ØªØª Ø¨Ø§Ø´Ù…."
                    };
                }
                
                return {
                    type: 'personal',
                    response: "Ù…Ù…Ù†ÙˆÙ† Ú©Ù‡ Ø§ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ùˆ Ø¨Ø§ Ù…Ù† Ø¯Ø± Ù…ÛŒØ§Ù† Ú¯Ø°Ø§Ø´ØªÛŒ. Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø®ÙˆØ¯Øª Ø¨Ú¯ÛŒØŸ"
                };
            }
            
            handleEmotion(message) {
                const lowerMessage = message.toLowerCase();
                
                if (/(Ø®ÙˆØ´Ø­Ø§Ù„Ù…|Ø®ÙˆØ´Ø­Ø§Ù„|happy)/i.test(lowerMessage)) {
                    return {
                        type: 'emotion',
                        response: "Ú†Ù‡ Ø¹Ø§Ù„ÛŒ Ú©Ù‡ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒ! ğŸ˜Š Ø¨Ø§Ø¹Ø« Ø®ÙˆØ´Ø­Ø§Ù„ÛŒÙ‡ Ú©Ù‡ Ø­Ø§Ù„ ØªÙˆ Ø®ÙˆØ¨Ù‡. Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø¯Ù„ÛŒÙ„ Ø®ÙˆØ´Ø­Ø§Ù„ÛŒØª Ø¨ÛŒØ´ØªØ± Ø¨Ú¯ÛŒØŸ"
                    };
                }
                
                if (/(ØºÙ…Ú¯ÛŒÙ†Ù…|Ù†Ø§Ø±Ø§Ø­ØªÙ…|ØºÙ…Ú¯ÛŒÙ†|Ù†Ø§Ø±Ø§Ø­Øª|sad)/i.test(lowerMessage)) {
                    return {
                        type: 'emotion',
                        response: "Ù…ØªØ£Ø³ÙÙ… Ú©Ù‡ Ø§Ø­Ø³Ø§Ø³ Ù†Ø§Ø±Ø§Ø­ØªÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ. ğŸ˜” Ø§Ú¯Ø± Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨Ø§ Ù…Ù† Ø¯Ø±Ø¨Ø§Ø±Ù‡Ø´ ØµØ­Ø¨Øª Ú©Ù†ÛŒ. Ø´Ø§ÛŒØ¯ Ø¨ØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù…."
                    };
                }
                
                if (/(Ø¹ØµØ¨Ø§Ù†ÛŒÙ…|Ø¹ØµØ¨Ø§Ù†ÛŒ|angry)/i.test(lowerMessage)) {
                    return {
                        type: 'emotion',
                        response: "Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒâ€ŒØ±Ø³Ù‡ Ú©Ù‡ Ø§Ø² Ú†ÛŒØ²ÛŒ Ø¹ØµØ¨Ø§Ù†ÛŒ Ù‡Ø³ØªÛŒ. ğŸ˜  Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø¨ÛŒØ´ØªØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡Ø´ Ø¨Ú¯ÛŒØŸ Ø´Ø§ÛŒØ¯ Ø¨ØªÙˆÙ†Ù… Ú©Ù…Ú©Øª Ú©Ù†Ù… Ú©Ù‡ Ø¢Ø±ÙˆÙ… Ø¨Ø´ÛŒ."
                    };
                }
                
                if (/(Ø®Ø³ØªÙ…|Ø®Ø³ØªÙ‡|tired)/i.test(lowerMessage)) {
                    return {
                        type: 'emotion',
                        response: "Ø¨Ù‡ Ù†Ø¸Ø± Ù…ÛŒâ€ŒØ±Ø³Ù‡ Ú©Ù‡ Ø®Ø³ØªÙ‡ Ù‡Ø³ØªÛŒ. ğŸ˜´ Ø§Ø³ØªØ±Ø§Ø­Øª Ù…ÛŒâ€ŒØªÙˆÙ†Ù‡ Ú©Ù…Ú© Ú©Ù†Ù‡ Ú©Ù‡ Ø´Ø§Ø±Ú˜ Ø¨Ø´ÛŒ. Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡Ø´ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ"
                    };
                }
                
                return {
                    type: 'emotion',
                    response: "Ù…ØªÙˆØ¬Ù‡ Ø§Ø­Ø³Ø§Ø³Øª Ù…ÛŒØ´Ù…. Ø§Ú¯Ø± Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒÙ… Ø¨ÛŒØ´ØªØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡Ø´ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…."
                };
            }
        }

        // ====== Ù…Ø¯ÛŒØ±ÛŒØª Ú†Øªâ€ŒØ¨Ø§Øª ======
        class ChatManager {
            constructor() {
                this.nlp = new AdvancedNLP();
                this.setupEventListeners();
                this.loadSettings();
            }
            
            setupEventListeners() {
                const sendBtn = document.getElementById('sendBtn');
                const userInput = document.getElementById('userInput');
                const themeToggle = document.getElementById('themeToggle');
                
                sendBtn.addEventListener('click', () => this.sendMessage());
                userInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
                
                themeToggle.addEventListener('click', () => this.toggleTheme());
            }
            
            sendMessage() {
                const userInput = document.getElementById('userInput');
                const message = userInput.value.trim();
                
                if (message === '') return;
                
                this.addMessage(message, 'user');
                userInput.value = '';
                
                this.showTypingIndicator();
                
                // Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù… Ø¨Ø§ ØªØ§Ø®ÛŒØ± Ø¨Ø±Ø§ÛŒ Ø·Ø¨ÛŒØ¹ÛŒâ€ŒØªØ± Ø´Ø¯Ù†
                setTimeout(() => {
                    this.hideTypingIndicator();
                    this.processMessage(message);
                }, 1000 + Math.random() * 1000);
            }
            
            processMessage(message) {
                const result = this.nlp.processMessage(message);
                
                if (result.type === 'math') {
                    this.addMathMessage(result.response, result.expression, result.result);
                } else {
                    this.addMessage(result.response, 'bot');
                }
            }
            
            addMessage(text, type) {
                const chatContainer = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                
                messageDiv.classList.add('message', type === 'user' ? 'user-message' : 'bot-message');
                
                const messageText = document.createElement('div');
                messageText.innerHTML = text;
                messageDiv.appendChild(messageText);
                
                const messageTime = document.createElement('div');
                messageTime.classList.add('message-time');
                messageTime.textContent = new Date().toLocaleTimeString('fa-IR');
                messageDiv.appendChild(messageTime);
                
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            addMathMessage(text, expression, result) {
                const chatContainer = document.getElementById('chatContainer');
                const messageDiv = document.createElement('div');
                
                messageDiv.classList.add('message', 'math-message');
                
                const messageText = document.createElement('div');
                messageText.innerHTML = text;
                messageDiv.appendChild(messageText);
                
                const messageTime = document.createElement('div');
                messageTime.classList.add('message-time');
                messageTime.textContent = new Date().toLocaleTimeString('fa-IR');
                messageDiv.appendChild(messageTime);
                
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            showTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'block';
            }
            
            hideTypingIndicator() {
                document.getElementById('typingIndicator').style.display = 'none';
            }
            
            toggleTheme() {
                document.body.classList.toggle('dark-mode');
                const themeToggle = document.getElementById('themeToggle');
                themeToggle.textContent = document.body.classList.contains('dark-mode') ? 'â˜€ï¸' : 'ğŸŒ™';
                
                // Ø°Ø®ÛŒØ±Ù‡ ØªÙ… Ø¯Ø± localStorage
                localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            }
            
            loadSettings() {
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªÙ… Ø§Ø² localStorage
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-mode');
                    document.getElementById('themeToggle').textContent = 'â˜€ï¸';
                }
            }
        }

        // Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ú†Øªâ€ŒØ¨Ø§Øª Ù‡Ù†Ú¯Ø§Ù…ÛŒ Ú©Ù‡ ØµÙØ­Ù‡ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯
        document.addEventListener('DOMContentLoaded', () => {
            window.chatManager = new ChatManager();
        });
    </script>
</body>
</html>
