<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú†Øªâ€ŒØ¨Ø§Øª BK JS Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #6c757d;
            --background-color: #f8f9fa;
            --user-message-bg: #e3f2fd;
            --bot-message-bg: #f1f0f0;
            --font-family: "Vazirmatn", "Tanha", "Segoe UI", Tahoma, sans-serif;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .message {
            max-width: 80%;
            padding: 0.75rem;
            border-radius: 1rem;
            animation: fadeIn 0.3s ease;
            position: relative;
        }
        
        .user-message {
            align-self: flex-end;
            background-color: var(--user-message-bg);
            border-bottom-right-radius: 0.25rem;
        }
        
        .bot-message {
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            border-bottom-left-radius: 0.25rem;
        }
        
        .message-time {
            font-size: 0.7rem;
            color: var(--secondary-color);
            margin-top: 0.25rem;
            text-align: right;
        }
        
        .input-container {
            display: flex;
            padding: 1rem;
            background-color: white;
            border-top: 1px solid #ddd;
        }
        
        #userInput {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 1.5rem;
            font-family: var(--font-family);
            outline: none;
        }
        
        #sendBtn {
            margin-right: 0.5rem;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        #sendBtn:hover {
            background-color: #3a5a80;
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: var(--bot-message-bg);
            padding: 0.75rem;
            border-radius: 1rem;
            margin-bottom: 0.5rem;
        }
        
        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }
        
        .typing-dot {
            width: 0.5rem;
            height: 0.5rem;
            background-color: var(--secondary-color);
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .settings-btn {
            position: absolute;
            left: 1rem;
            top: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: white;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background: white;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
            padding: 1rem;
            transition: left 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .settings-panel.active {
            left: 0;
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #ddd;
        }

        .close-settings {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .setting-item {
            margin-bottom: 1rem;
        }

        .setting-item label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }

        .setting-item input, .setting-item select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 0.25rem;
            font-family: var(--font-family);
        }

        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .overlay.active {
            display: block;
        }
    </style>
    <!-- ÙÙˆÙ†Øª Vazirmatn Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ø§Ø² ÙØ§Ø±Ø³ÛŒ -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css">
</head>
<body>
    <div class="header">
        <button class="settings-btn">âš™ï¸</button>
        <h1>Ú†Øªâ€ŒØ¨Ø§Øª BK JS</h1>
        <p>Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ</p>
    </div>
    
    <div class="chat-container" id="chatContainer">
        <div class="message bot-message">
            Ø³Ù„Ø§Ù…! Ù…Ù† BK JS Ù‡Ø³ØªÙ…ØŒ Ú†Øªâ€ŒØ¨Ø§Øª Ù¾ÛŒØ´Ø±ÙØªÙ‡. Ú†Ø·ÙˆØ± Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ú©Ù…Ú©ØªÙˆÙ† Ú©Ù†Ù…ØŸ
            <div class="message-time">Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù†</div>
        </div>
    </div>
    
    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        </div>
    </div>
    
    <div class="input-container">
        <input type="text" id="userInput" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
        <button id="sendBtn">Ø§Ø±Ø³Ø§Ù„</button>
    </div>

    <div class="overlay" id="overlay"></div>
    
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2>ØªÙ†Ø¸ÛŒÙ…Ø§Øª</h2>
            <button class="close-settings">Ã—</button>
        </div>
        
        <div class="setting-item">
            <label for="userName">Ù†Ø§Ù… Ø´Ù…Ø§</label>
            <input type="text" id="userName" value="Ú©Ø§Ø±Ø¨Ø±">
        </div>
        
        <div class="setting-item">
            <label for="chatMode">Ù…ÙˆØ¯ Ú¯ÙØªÚ¯Ùˆ</label>
            <select id="chatMode">
                <option value="normal">Ø¹Ø§Ø¯ÛŒ</option>
                <option value="funny">Ø®Ù†Ø¯Ù‡ Ø¯Ø§Ø± ğŸ˜‚</option>
                <option value="romantic">Ø±Ù…Ø§Ù†ØªÛŒÚ© ğŸ’–</option>
                <option value="serious">Ø¬Ø¯ÛŒ ğŸ§</option>
                <option value="pro">Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ ğŸ¤–</option>
                <option value="sarcastic">Ø·Ù†Ø² ğŸ˜</option>
                <option value="angry">Ø¹ØµØ¨ÛŒ ğŸ˜¡</option>
            </select>
        </div>
        
        <div class="setting-item">
            <label for="fontSize">Ø§Ù†Ø¯Ø§Ø²Ù‡ ÙÙˆÙ†Øª</label>
            <select id="fontSize">
                <option value="small">Ú©ÙˆÚ†Ú©</option>
                <option value="medium" selected>Ù…ØªÙˆØ³Ø·</option>
                <option value="large">Ø¨Ø²Ø±Ú¯</option>
            </select>
        </div>
        
        <div class="setting-item">
            <button id="clearHistoryBtn" style="width: 100%; padding: 0.75rem; background: #ff4757; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú¯ÙØªÚ¯Ùˆ
            </button>
        </div>
        
        <div class="setting-item">
            <button id="exportDataBtn" style="width: 100%; padding: 0.75rem; background: var(--primary-color); color: white; border: none; border-radius: 0.25rem; cursor: pointer;">
                Ø°Ø®ÛŒØ±Ù‡ Ú¯ÙØªÚ¯Ùˆ
            </button>
        </div>
    </div>

    <script>
        // ====== Ø§Ø¨Ø± BK JS â€“ Ù†Ø³Ø®Ù‡ Ù¾ÛŒØ´Ø±ÙØªÙ‡ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ ======
        const keywordsDB = {
            greeting: ["Ø³Ù„Ø§Ù…", "Ø¯Ø±ÙˆØ¯", "Ù‡ÛŒ", "ØµØ¨Ø­ Ø¨Ø®ÛŒØ±", "Ø´Ø¨ Ø¨Ø®ÛŒØ±", "Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒ", "Ø§Ø­ÙˆØ§Ù„Ù¾Ø±Ø³ÛŒ", "Ú†Ø·ÙˆØ±ÛŒ", "Ø­Ø§Ù„Øª", "ÙˆÙ‚Øª Ø¨Ø®ÛŒØ±", "Ø³Ù„Ø§Ù…ØªÛŒ", "hello", "hi", "hey", "good morning", "good night"],
            personal: ["Ú†Ù†Ø¯ Ø³Ø§Ù„ØªÙ‡", "Ø§Ø³Ù…Øª", "Ù†Ø§Ù…", "Ø§Ù‡Ù„ Ú©Ø¬Ø§ÛŒÛŒ", "Ø´ØºÙ„", "ØªØ­ØµÛŒÙ„", "Ø±Ø´ØªÙ‡", "Ø²Ø¨Ø§Ù†", "Ø®Ø§Ù†ÙˆØ§Ø¯Ù‡", "ØªÙˆÙ„Ø¯", "Ù…Ø­Ù„ Ø²Ù†Ø¯Ú¯ÛŒ", "Ù…Ù„ÛŒØª", "Ø§Ù‚Ø§Ù…Øª", "name", "age", "job", "study"],
            weather: ["Ù‡ÙˆØ§", "Ø¨Ø§Ø±Ø§Ù†", "Ø¨Ø±Ù", "Ø¢ÙØªØ§Ø¨ÛŒ", "Ø§Ø¨Ø±ÛŒ", "Ø¯Ù…Ø§", "Ú¯Ø±Ù…Ø§", "Ø³Ø±Ù…Ø§", "ÙØµÙ„", "Ø¨Ø§Ø¯", "Ø®ÙˆØ±Ø´ÛŒØ¯", "Ø·ÙˆÙØ§Ù†", "Ø±Ø·ÙˆØ¨Øª", "Ù…Ù‡", "weather", "rain", "snow", "sunny", "cloudy", "temperature"],
            daily: ["Ø¨Ø±Ù†Ø§Ù…Ù‡", "Ú©Ø§Ø±", "Ø±ÙˆØ²", "Ø§Ù…Ø±ÙˆØ²", "ÙØ±Ø¯Ø§", "Ù‡ÙØªÙ‡", "Ù…Ø§Ù‡", "Ø³Ø§Ù„", "Ø±ÙˆØªÛŒÙ†", "ØµØ¨Ø­", "Ø´Ø¨", "Ù‡Ø¯Ù", "ÙˆØ¸ÛŒÙÙ‡", "ØªÚ©Ù„ÛŒÙ", "plan", "work", "day", "today", "tomorrow"],
            fun: ["Ø¬ÙˆÚ©", "Ø®Ù†Ø¯Ù‡", "Ù…Ø¹Ù…Ø§", "ÙØ§Ù†", "Ø³Ø±Ú¯Ø±Ù…ÛŒ", "Ù…ÛŒÙ…", "Ø·Ù†Ø²", "Ø³Ø±Ú¯Ø±Ù…â€ŒÚ©Ù†Ù†Ø¯Ù‡", "joke", "fun", "riddle", "meme"],
            tech: ["Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±", "Ú¯ÙˆØ´ÛŒ", "Ù…ÙˆØ¨Ø§ÛŒÙ„", "Ø§ÛŒÙ†ØªØ±Ù†Øª", "AI", "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "Ø¨Ø§Ø²ÛŒ", "Ø±Ø¨Ø§Øª", "ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ", "Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†", "Ù†Ø±Ù… Ø§ÙØ²Ø§Ø±", "computer", "phone", "internet", "ai", "technology", "app"],
            emotions: ["Ø®ÙˆØ´Ø­Ø§Ù„Ù…", "ØºÙ…Ú¯ÛŒÙ†Ù…", "Ø¹ØµØ¨Ø§Ù†ÛŒÙ…", "Ø®Ø³ØªÙ…", "Ø§Ø³ØªØ±Ø³ Ø¯Ø§Ø±Ù…", "Ø´Ø§Ø¯Ù…", "Ù†Ø§Ø±Ø§Ø­ØªÙ…", "Ø´Ú¯ÙØª Ø²Ø¯Ù‡", "Ù‡ÛŒØ¬Ø§Ù† Ø²Ø¯Ù‡", "Ú©Ù„Ø§ÙÙ‡", "happy", "sad", "angry", "tired", "stressed", "excited"],
            learning: ["ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±", "Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø¯Ù‡", "Ú†Ø·ÙˆØ±ÛŒ", "ÛŒØ§Ø¯Ù… Ø¨Ø¯Ù‡", "Ú†Ú¯ÙˆÙ†Ù‡", "Ø·Ø±ÛŒÙ‚Ù‡", "Ø±ÙˆØ´", "teach", "learn", "how to", "way to"]
        };

        const templatesDB = {
            greeting: ["Ø³Ù„Ø§Ù… {name}ØŒ Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ", "Ø¯Ø±ÙˆØ¯ØŒ Ø§Ù…Ø±ÙˆØ² Ú†Ø·ÙˆØ±ÛŒØŸ", "Ù‡ÛŒ {name}ØŒ Ø®ÙˆØ¨ÛŒØŸ", "Ø³Ù„Ø§Ù… Ø±ÙÛŒÙ‚ØŒ Ú†Ù‡ Ø®Ø¨Ø±ØŸ"],
            personal: ["Ù…Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ BK Ù‡Ø³ØªÙ…ØŒ ØªÙˆ Ú†ÛŒØŸ", "Ø§Ø³Ù… Ù…Ù† BK Ù‡Ø³ØªØŒ ØªÙˆ Ú†ÛŒØŸ", "Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù… Ø¨ÛŒØ´ØªØ± Ø¯Ø±Ø¨Ø§Ø±Ù‡ ØªÙˆ Ø¨Ø¯ÙˆÙ†Ù…!"],
            weather: ["Ø§Ù…Ø±ÙˆØ² Ù‡ÙˆØ§ {adj}Ù‡ØŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨Ø±ÛŒÙ… Ø¨ÛŒØ±ÙˆÙ†ØŸ", "Ú†Ù‡ Ù‡ÙˆØ§ÛŒ {adj}Ø§ÛŒ! Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø¯Ø§Ø±ÛŒØŸ", "Ù‡ÙˆØ§ Ø§Ù…Ø±ÙˆØ² {adj}Ù‡ØŒ Ø­Ø³ Ùˆ Ø­Ø§Ù„Øª Ú†Ø·ÙˆØ±Ù‡ØŸ"],
            daily: ["Ú†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ {time} Ø¯Ø§Ø±ÛŒØŸ", "Ø§Ù…Ø±ÙˆØ² Ú†ÛŒÚ©Ø§Ø± Ú©Ø±Ø¯ÛŒØŸ", "ÙØ±Ø¯Ø§ Ú†Ù‡ Ú©Ø§Ø±ÛŒ Ø¯Ø§Ø±ÛŒØŸ", "Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ§Øª Ø¨Ø±Ø§ÛŒ {time} Ú†ÛŒÙ‡ØŸ"],
            fun: ["Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ ÛŒÙ‡ Ø¬ÙˆÚ© Ø¨Ø±Ø§Øª ØªØ¹Ø±ÛŒÙ Ú©Ù†Ù…ØŸ", "ÛŒÙ‡ Ù…Ø¹Ù…Ø§ Ø¯Ø§Ø±ÛŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø­Ù„Ø´ Ú©Ù†ÛŒØŸ", "Ø®Ù†Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø³Ù„Ø§Ù…ØªÛŒÙ‡ ğŸ˜„", "Ù…ÛŒØ®ÙˆØ§ÛŒ ÛŒÙ‡ Ø³Ø±Ú¯Ø±Ù…ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯ÛŒÙ…ØŸ"],
            tech: ["Ø§Ù…Ø±ÙˆØ² Ø¯Ø± Ø¯Ù†ÛŒØ§ÛŒ ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ Ú†Ù‡ Ø®Ø¨Ø±ØŸ", "Ù…ÛŒØ®ÙˆØ§ÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ AI Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ", "Ø±Ø¨Ø§Øªâ€ŒÙ‡Ø§ Ø±ÙˆØ² Ø¨Ù‡ Ø±ÙˆØ² Ù‡ÙˆØ´Ù…Ù†Ø¯ØªØ± Ù…ÛŒØ´Ù†", "Ù…ÛŒØ®ÙˆØ§ÛŒ ÛŒÙ‡ Ù†Ú©ØªÙ‡ ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ Ø¨Ø±Ø§Øª Ø¨Ú¯Ù…ØŸ"],
            emotions: ["Ù…ÛŒØ¨ÛŒÙ†Ù… Ø§Ù…Ø±ÙˆØ² {emo} Ù‡Ø³ØªÛŒØŒ Ù…ÛŒØ®ÙˆØ§ÛŒ Ø±Ø§Ø¬Ø¹ Ø¨Ù‡Ø´ Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ", "Ø­Ø§Ù„Øª {emo}Ù‡ØŒ Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ ÛŒÙ‡ Ú†ÛŒØ² Ø®ÙˆØ´Ø­Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ø¨Ø±Ø§Øª ØªØ¹Ø±ÛŒÙ Ú©Ù†Ù…ØŸ", "Ø§Ø­Ø³Ø§Ø³ {emo} Ø¯Ø§Ø±ÛŒØŸ Ø¨ÛŒØ§ Ú©Ù…ÛŒ ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…!"],
            learning: ["Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¯Ø± Ù…ÙˆØ±Ø¯ {topic} Ú†ÛŒØ²ÛŒ ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±ÛŒÙ…ØŸ", "Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¨Ø±Ø§Øª Ø¯Ø±Ø¨Ø§Ø±Ù‡ {topic} ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯Ù…ØŸ", "ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ {topic} Ù…ÛŒØªÙˆÙ†Ù‡ Ø¬Ø§Ù„Ø¨ Ø¨Ø§Ø´Ù‡!"]
        };

        const adjectives = ["Ù‚Ø´Ù†Ú¯", "Ø®ÙˆØ¨", "Ø¹Ø§Ù„ÛŒ", "ÙÙˆÙ‚Ø§Ù„Ø¹Ø§Ø¯Ù‡", "Ù„Ø·ÛŒÙ", "Ø®Ù†Ú©", "Ú¯Ø±Ù…", "Ù…Ø±Ø·ÙˆØ¨", "Ø´Ø±Ø¬ÛŒ", "ØªØ§Ø²Ù‡"];
        const times = ["Ø§Ù…Ø±ÙˆØ²", "ÙØ±Ø¯Ø§", "Ø§ÛŒÙ† Ù‡ÙØªÙ‡", "Ø§ÛŒÙ† Ù…Ø§Ù‡", "Ø¢Ø®Ø± Ù‡ÙØªÙ‡", "ØªØ¹Ø·ÛŒÙ„Ø§Øª", "Ø¢ÛŒÙ†Ø¯Ù‡"];
        const emotions = ["Ø®ÙˆØ´Ø­Ø§Ù„", "ØºÙ…Ú¯ÛŒÙ†", "Ø¹ØµØ¨ÛŒ", "Ø®Ø³ØªÙ‡", "Ø´Ø§Ø¯", "Ù†Ø§Ø±Ø§Ø­Øª", "Ø´Ú¯ÙØªâ€ŒØ²Ø¯Ù‡", "Ù‡ÛŒØ¬Ø§Ù† Ø²Ø¯Ù‡", "Ú©Ù„Ø§ÙÙ‡"];
        const modes = { normal: "", funny: "ğŸ˜‚", romantic: "ğŸ’–", serious: "ğŸ§", pro: "ğŸ¤–", sarcastic: "ğŸ˜", angry: "ğŸ˜¡" };

        let userData = { 
            name: "Ú©Ø§Ø±Ø¨Ø±", 
            mode: "normal", 
            history: [], 
            lastTopics: [], 
            lastResponses: [], 
            interests: [],
            learnedResponses: {} // Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡ Ø¬Ø¯ÛŒØ¯
        };

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø§Ø² localStorage Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ù‡
        if (localStorage.getItem('userData')) {
            try {
                const savedData = JSON.parse(localStorage.getItem('userData'));
                userData = { ...userData, ...savedData };
                
                // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± ØªÙ†Ø¸ÛŒÙ…Ø§Øª
                document.getElementById('userName').value = userData.name;
                document.getElementById('chatMode').value = userData.mode;
            } catch (e) {
                console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡:", e);
            }
        }

        // ====== ØªÙˆÙ„ÛŒØ¯ Ù¾Ø§Ø³Ø® Ù¾ÛŒØ´Ø±ÙØªÙ‡ ======
        function generateResponse(msg) {
            const message = msg.toLowerCase().trim();
            userData.history.push({
                text: message,
                time: new Date().toLocaleTimeString('fa-IR')
            });
            
            if (userData.history.length > 100) userData.history.shift(); // Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡

            // Ø¨Ø±Ø±Ø³ÛŒ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡
            for (const learnedQuestion in userData.learnedResponses) {
                if (message.includes(learnedQuestion.toLowerCase())) {
                    return userData.learnedResponses[learnedQuestion];
                }
            }

            // ØªØ´Ø®ÛŒØµ Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± (Ù…Ø«Ù„ "Ø§Ø³Ù…Ù… Ø¹Ù„ÛŒ Ù‡Ø³Øª")
            const nameMatch = message.match(/(Ø§Ø³Ù…Ù…|Ù†Ø§Ù…Ù…|Ù…Ù†\s*)(.+?)(Ù‡Ø³ØªÙ…|Ø§Ø³Øª|Ù‡|Ù‡Ø³|Ù…ÛŒÚ¯Ù†|Ù‡Ø³Øª)/i);
            if (nameMatch && nameMatch[2]) {
                setUserName(nameMatch[2].trim());
            }

            // ØªØ´Ø®ÛŒØµ ØªØºÛŒÛŒØ± Ù…ÙˆØ¯ (Ù…Ø«Ù„ "Ù…ÙˆØ¯ funny" ÛŒØ§ "mode sarcastic")
            const modeMatch = message.match(/(Ù…ÙˆØ¯|mode)\s*(\w+)/i);
            if (modeMatch && modeMatch[2]) {
                setUserMode(modeMatch[2].toLowerCase());
            }

            // ØªØ´Ø®ÛŒØµ Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ‡Ø§ (Ù…Ø«Ù„ "Ø¹Ù„Ø§Ù‚Ù‡â€ŒØ§Ù… Ø¨Ù‡ ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ")
            const interestMatch = message.match(/(Ø¹Ù„Ø§Ù‚Ù‡|Ø¯ÙˆØ³Øª Ø¯Ø§Ø±Ù…|Ù‡Ø§Ø¨ÛŒ|Ø³Ø±Ú¯Ø±Ù…ÛŒ)\s*(Ø¨Ù‡|Ø¯Ø±|Ø¨Ø§)?\s*(.+)/i);
            if (interestMatch && interestMatch[3]) {
                addInterest(interestMatch[3].trim());
            }

            // Ø³ÛŒØ³ØªÙ… ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ (Ù…Ø«Ù„ "ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ± ÙˆÙ‚ØªÛŒ Ù…ÛŒÚ¯Ù… Ø³Ù„Ø§Ù… Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡ Ø¯Ø±ÙˆØ¯")
            const learnMatch = message.match(/(ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ±|Ø¢Ù…ÙˆØ²Ø´ Ø¨Ø¯Ù‡) ÙˆÙ‚ØªÛŒ Ù…ÛŒÚ¯Ù… (.+?) Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡ (.+)/i);
            if (learnMatch && learnMatch[2] && learnMatch[3]) {
                userData.learnedResponses[learnMatch[2].trim()] = learnMatch[3].trim();
                localStorage.setItem('userData', JSON.stringify(userData));
                return `Ú†Ø´Ù…! ÛŒØ§Ø¯ Ú¯Ø±ÙØªÙ… ÙˆÙ‚ØªÛŒ Ù…ÛŒÚ¯ÛŒ "${learnMatch[2].trim()}" Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù… "${learnMatch[3].trim()}"`;
            }

            // Ù…Ø¹Ø±ÙÛŒ Ø±Ø¨Ø§Øª
            const selfKeywords = ["ØªÙˆ Ú†ÛŒ Ù‡Ø³ØªÛŒ", "ØªÙˆ Ú†Ù‡ Ù…Ø¯Ù„ÛŒ", "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªÙˆ", "Ú†ÛŒ Ù‡Ø³ØªÛŒ", "Ù…Ø¯Ù„ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "who are you", "what are you"];
            if (selfKeywords.some(k => message.includes(k.toLowerCase()))) return randomChoice([
                "Ù…Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ BK Ù‡Ø³ØªÙ… ğŸ¤–ØŒ ÛŒÚ© Ø±Ø¨Ø§Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ú†Øª Ùˆ Ú©Ù…Ú©!",
                "Ø§Ø³Ù… Ù…Ù† BK Ù‡Ø³ØªØŒ ÛŒÚ© AI Ù¾ÛŒØ´Ø±ÙØªÙ‡ ğŸ˜",
                "Ù…Ù† Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ BK Ù‡Ø³ØªÙ…ØŒ Ø®ÙˆØ´Ø¨Ø®ØªÙ…! Ù…ÛŒâ€ŒØªÙˆÙ†Ù… Ø¯Ø± Ù…ÙˆØ±Ø¯ {interest} Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ".replace("{interest}", userData.interests.length > 0 ? randomChoice(userData.interests) : "Ù‡Ø± Ú†ÛŒØ²ÛŒ")
            ]);

            // Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø¨ÛŒâ€ŒØ§Ø­ØªØ±Ø§Ù…ÛŒ Ùˆ +18 (ÙÛŒÙ„ØªØ±ÛŒÙ†Ú¯ Ú¯Ø³ØªØ±Ø¯Ù‡â€ŒØªØ± Ø¨Ø§ regex)
            const rudeRegex = /(Ø¨ÛŒ Ø§Ø¯Ø¨|Ø­Ø±Ø§Ù…Ø²Ø§Ø¯Ù‡|Ù„Ø¹Ù†ØªÛŒ|Ø³Ú©Ø³|Ø¬Ù†Ø³ÛŒ|\+18|fuck|shit|sex|idiot|stupid|f\*\*k|sh\*\*|Ú©ÙˆØ³|Ú©ÙˆØ³ Ù†Ù†Øª|Ú©ÙˆØ³ Ú©Ø´|Ù…Ø§Ø¯Ø± Ø®Ø±Ø§Ø¨|Ú©Ø§Ø¯Ø± Ø¬Ù†Ø¯Ù‡|Ø¬Ù†Ø¯Ù‡|Ú©ÙˆØ³ Ù†Ú¯Ùˆ|Ú©ÙˆÙ†ÛŒ|Ú¯ÛŒ|Ù…Ø§Ø¯Ø±Øª Ø±Ùˆ Ú¯Ø§ÛŒØ¯Ù…|Ú©ÙˆØ³ ØµÙˆØ±ØªÛŒ|ÙØ§Ú©ÛŒÙˆ|Ù†Ù†Øª Ø±Ùˆ Ú¯Ø§ÛŒØ¯Ù…|Ù†Ù†Ù‡ Ø¬Ù†Ø¯Ù‡|Ù†Ù†Ù‡ Ø®Ø±Ø§Ø¨)/i;
            if (rudeRegex.test(message)) return randomChoice([
                "Ù„Ø·ÙØ§ Ø§Ø¯Ø¨ Ø±Ùˆ Ø±Ø¹Ø§ÛŒØª Ú©Ù†ÛŒØ¯ ğŸ˜”",
                "Ø§ÛŒÙ† Ù†ÙˆØ¹ ØµØ­Ø¨Øª Ú©Ø±Ø¯Ù† Ù…Ù†Ø§Ø³Ø¨ Ù†ÛŒØ³Øª ğŸ™",
                "Ø¨ÛŒØ§ÛŒÛŒØ¯ Ø¨Ø§ Ø§Ø­ØªØ±Ø§Ù… Ø¨Ø§ Ù‡Ù… Ú¯ÙØªÚ¯Ùˆ Ú©Ù†ÛŒÙ… ğŸ¤"
            ]);

            // Ø´Ù†Ø§Ø³Ø§ÛŒÛŒ Ø¯Ø³ØªÙ‡â€ŒÙ‡Ø§ Ø¨Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ (Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² regex Ø¨Ø±Ø§ÛŒ Ø¯Ù‚Øª Ø¨ÛŒØ´ØªØ±)
            const matched = [];
            for (const cat in keywordsDB) {
                if (keywordsDB[cat].some(k => new RegExp(k, 'i').test(message))) matched.push(cat);
            }
            
            if (matched.length === 0) {
                // Ø§Ú¯Ø± Ø³ÙˆØ§Ù„ Ø¨ÙˆØ¯ Ø§Ù…Ø§ Ù¾Ø§Ø³Ø® Ø¯Ø§Ø¯Ù‡ Ù†Ø´Ø¯ØŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø¨Ø¯Ù‡
                if (message.includes('ØŸ') || message.includes('?')) {
                    return "Ù…ØªÙˆØ¬Ù‡ Ø³ÙˆØ§Ù„Øª Ù†Ø´Ø¯Ù…. Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ ÛŒØ§Ø¯Ù… Ø¨Ø¯ÛŒ Ú†Ø·ÙˆØ± Ø¨Ù‡ Ø§ÛŒÙ† Ø³ÙˆØ§Ù„ Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù…ØŸ (Ø¨Ù†ÙˆÛŒØ³: ÛŒØ§Ø¯ Ø¨Ú¯ÛŒØ± ÙˆÙ‚ØªÛŒ Ù…ÛŒÚ¯Ù… \"Ø³ÙˆØ§Ù„ ØªÙˆ\" Ø¬ÙˆØ§Ø¨ Ø¨Ø¯Ù‡ \"Ù¾Ø§Ø³Ø® Ù…Ù†Ø§Ø³Ø¨\")";
                }
                
                return randomChoice([
                    "Ø¬Ø§Ù„Ø¨ Ø§Ø³Øª! Ø¨ÛŒØ´ØªØ± Ø¨Ø±Ø§Ù… ØªØ¹Ø±ÛŒÙ Ú©Ù†.",
                    "Ú†Ù‡ Ø®ÙˆØ¨! Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ± ØµØ­Ø¨Øª Ú©Ù†ÛŒÙ…ØŸ",
                    "Ù…Ù†Ø¸ÙˆØ±Øª Ø±Ùˆ Ù…ØªÙˆØ¬Ù‡ Ù†Ø´Ø¯Ù…ØŒ Ù…ÛŒØ´Ù‡ ØªÙˆØ¶ÛŒØ­ Ø¨Ø¯ÛŒØŸ",
                    "Ø¯ÙˆØ³Øª Ø¯Ø§Ø±ÛŒ ÛŒÙ‡ Ù…ÙˆØ¶ÙˆØ¹ Ø¬Ø¯ÛŒØ¯ Ø´Ø±ÙˆØ¹ Ú©Ù†ÛŒÙ…ØŸ Ø´Ø§ÛŒØ¯ Ø¯Ø± Ù…ÙˆØ±Ø¯ {interest}ØŸ".replace("{interest}", userData.interests.length > 0 ? randomChoice(userData.interests) : "Ù‡Ø± Ú†ÛŒØ²ÛŒ")
                ]);
            }

            // ØªØ±Ú©ÛŒØ¨ Ù¾Ø§Ø³Ø® Ú†Ù†Ø¯ Ø¯Ø³ØªÙ‡â€ŒØ§ÛŒ (1 ØªØ§ 3 Ø¯Ø³ØªÙ‡) Ø¨Ø§ Ø¨Ù‡Ø¨ÙˆØ¯ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ
            const selected = randomItems(matched, Math.min(matched.length, 3));
            let response = selected.map(cat => {
                let tpl = randomChoice(templatesDB[cat]);
                // Ø¨Ù‡Ø¨ÙˆØ¯ {emo}: Ø³Ø¹ÛŒ Ø¯Ø± ØªØ´Ø®ÛŒØµ Ø§Ø­Ø³Ø§Ø³ ÙˆØ§Ù‚Ø¹ÛŒ
                let emo = randomChoice(emotions);
                for (const e of emotions) {
                    if (message.includes(e)) {
                        emo = e;
                        break;
                    }
                }
                
                // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ø² Ù¾ÛŒØ§Ù… Ø¨Ø±Ø§ÛŒ Ø¨Ø®Ø´ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ
                let topic = extractTopic(message, cat);
                
                tpl = tpl.replace(/{name}/g, userData.name)
                    .replace(/{adj}/g, randomChoice(adjectives))
                    .replace(/{time}/g, randomChoice(times))
                    .replace(/{emo}/g, emo)
                    .replace(/{topic}/g, topic);
                return tpl;
            }).join("\n"); // Ø¬ÙˆÛŒÙ† Ø¨Ø§ Ø®Ø· Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø®ÙˆØ§Ù†Ø§ÛŒÛŒ Ø¨Ù‡ØªØ±

            // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø¹Ù„Ø§Ù‚Ù‡â€ŒÙ‡Ø§ Ø¨Ù‡ Ù¾Ø§Ø³Ø® Ø§Ú¯Ø± Ù…Ø±ØªØ¨Ø·
            if (userData.interests.length > 0 && Math.random() > 0.7) {
                response += `\nØ±Ø§Ø³ØªÛŒØŒ Ø¯ÛŒØ¯Ù… Ø¨Ù‡ ${randomChoice(userData.interests)} Ø¹Ù„Ø§Ù‚Ù‡ Ø¯Ø§Ø±ÛŒØŒ Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ø¨ÛŒØ´ØªØ± Ø­Ø±Ù Ø¨Ø²Ù†ÛŒÙ…ØŸ`;
            }

            // Ù…ÙˆØ¯
            if (modes[userData.mode]) response += " " + modes[userData.mode];

            // Ø­Ø§ÙØ¸Ù‡ Ú©ÙˆØªØ§Ù‡
            userData.lastTopics = [...selected];
            userData.lastResponses.push(response);
            if (userData.lastResponses.length > 50) userData.lastResponses.shift();

            // Ø°Ø®ÛŒØ±Ù‡ Ø¯Ø± localStorage
            localStorage.setItem('userData', JSON.stringify(userData));

            return response;
        }

        // ====== Ú©Ù…Ú©ÛŒ ======
        function randomChoice(arr) { return arr[Math.floor(Math.random() * arr.length)]; }
        
        function randomItems(arr, n) {
            // Ø¨Ù‡Ø¨ÙˆØ¯ randomness Ø¨Ø§ Fisher-Yates shuffle
            const shuffled = [...arr];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled.slice(0, n);
        }
        
        function setUserName(name) { 
            userData.name = name || "Ú©Ø§Ø±Ø¨Ø±"; 
            document.getElementById('userName').value = userData.name;
            localStorage.setItem('userData', JSON.stringify(userData));
        }
        
        function setUserMode(mode) { 
            if (modes[mode]) {
                userData.mode = mode; 
                document.getElementById('chatMode').value = userData.mode;
                localStorage.setItem('userData', JSON.stringify(userData));
            }
        }
        
        function addInterest(interest) { 
            if (!userData.interests.includes(interest)) {
                userData.interests.push(interest); 
                localStorage.setItem('userData', JSON.stringify(userData));
            }
        }
        
        function getLastTopics() { return userData.lastTopics; }
        function getLastResponses() { return userData.lastResponses; }
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ø² Ù¾ÛŒØ§Ù…
        function extractTopic(message, category) {
            // Ø§ÛŒÙ† ØªØ§Ø¨Ø¹ Ø³Ø¹ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ù…ÙˆØ¶ÙˆØ¹ Ø§ØµÙ„ÛŒ Ù¾ÛŒØ§Ù… Ø±Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†Ø¯
            const words = message.split(' ');
            if (words.length > 2) {
                // Ø¨Ø±Ø§ÛŒ Ø³ÙˆØ§Ù„Ø§Øª "Ú†Ø·ÙˆØ±" Ùˆ "Ú†Ú¯ÙˆÙ†Ù‡"
                if (message.includes('Ú†Ø·ÙˆØ±') || message.includes('Ú†Ú¯ÙˆÙ†Ù‡') || message.includes('how')) {
                    return words.slice(words.findIndex(w => w === 'Ú†Ø·ÙˆØ±' || w === 'Ú†Ú¯ÙˆÙ†Ù‡' || w === 'how') + 1).join(' ');
                }
                
                // Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØ± Ù…ÙˆØ§Ø±Ø¯ØŒ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ø±Ø§ Ø¨Ø±Ù…ÛŒâ€ŒÚ¯Ø±Ø¯Ø§Ù†Ø¯
                return words.slice(-2).join(' ');
            }
            return category;
        }

        // ====== Ø±Ø§Ø¨Ø· Ú©Ø§Ø±Ø¨Ø±ÛŒ JS ======
        const inputField = document.getElementById("userInput");
        const sendBtn = document.getElementById("sendBtn");
        const chatContainer = document.getElementById("chatContainer");
        const typingIndicator = document.getElementById("typingIndicator");
        const settingsBtn = document.querySelector(".settings-btn");
        const settingsPanel = document.getElementById("settingsPanel");
        const overlay = document.getElementById("overlay");
        const closeSettings = document.querySelector(".close-settings");
        const userNameInput = document.getElementById("userName");
        const chatModeSelect = document.getElementById("chatMode");
        const fontSizeSelect = document.getElementById("fontSize");
        const clearHistoryBtn = document.getElementById("clearHistoryBtn");
        const exportDataBtn = document.getElementById("exportDataBtn");

        function addMessage(msg, type) {
            const el = document.createElement("div");
            el.classList.add("message", type === "user" ? "user-message" : "bot-message");
            
            const messageText = document.createElement("div");
            messageText.textContent = msg;
            el.appendChild(messageText);
            
            const messageTime = document.createElement("div");
            messageTime.classList.add("message-time");
            messageTime.textContent = new Date().toLocaleTimeString('fa-IR');
            el.appendChild(messageTime);
            
            chatContainer.appendChild(el);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showTypingIndicator() {
            typingIndicator.style.display = 'block';
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function hideTypingIndicator() {
            typingIndicator.style.display = 'none';
        }

        function sendMessage() {
            const msg = inputField.value.trim();
            if (msg === "") return;
            
            addMessage(msg, "user");
            inputField.value = "";
            
            showTypingIndicator();
            
            setTimeout(() => {
                hideTypingIndicator();
                addMessage(generateResponse(msg), "bot");
            }, 1000 + Math.random() * 1000); // ØªØ§ÛŒÙ¾ Ú©Ø±Ø¯Ù† ØªØµØ§Ø¯ÙÛŒ Ø¨ÛŒÙ† 1-2 Ø«Ø§Ù†ÛŒÙ‡
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª ØªÙ†Ø¸ÛŒÙ…Ø§Øª
        settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.add('active');
            overlay.classList.add('active');
        });

        closeSettings.addEventListener('click', () => {
            settingsPanel.classList.remove('active');
            overlay.classList.remove('active');
        });

        overlay.addEventListener('click', () => {
            settingsPanel.classList.remove('active');
            overlay.classList.remove('active');
        });

        userNameInput.addEventListener('change', (e) => {
            setUserName(e.target.value);
        });

        chatModeSelect.addEventListener('change', (e) => {
            setUserMode(e.target.value);
        });

        fontSizeSelect.addEventListener('change', (e) => {
            document.documentElement.style.fontSize = 
                e.target.value === 'small' ? '14px' : 
                e.target.value === 'medium' ? '16px' : '18px';
        });

        clearHistoryBtn.addEventListener('click', () => {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú¯ÙØªÚ¯Ùˆ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
                userData.history = [];
                userData.lastResponses = [];
                userData.lastTopics = [];
                localStorage.setItem('userData', JSON.stringify(userData));
                
                // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ (Ø¨Ù‡ Ø¬Ø² Ø§ÙˆÙ„ÛŒÙ† Ù¾ÛŒØ§Ù… Ø±Ø¨Ø§Øª)
                const messages = chatContainer.querySelectorAll('.message');
                for (let i = messages.length - 1; i > 0; i--) {
                    chatContainer.removeChild(messages[i]);
                }
                
                alert('ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú¯ÙØªÚ¯Ùˆ Ù¾Ø§Ú© Ø´Ø¯.');
            }
        });

        exportDataBtn.addEventListener('click', () => {
            const dataStr = JSON.stringify(userData, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `bk-chat-data-${new Date().toLocaleDateString('fa-IR')}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        });

        sendBtn.addEventListener("click", sendMessage);
        inputField.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ú¯ÙØªÚ¯Ùˆ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§
        window.addEventListener('load', () => {
            if (userData.history.length > 0) {
                // ÙÙ‚Ø· Ø¢Ø®Ø±ÛŒÙ† 10 Ù¾ÛŒØ§Ù… Ø±Ø§ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯Ù‡
                const recentHistory = userData.history.slice(-10);
                
                recentHistory.forEach(item => {
                    addMessage(item.text, "user");
                    // Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒØŒ Ù¾Ø§Ø³Ø® Ø±Ø¨Ø§Øª Ø±Ø§ Ù†Ø´Ø§Ù† Ù†Ù…ÛŒâ€ŒØ¯Ù‡ÛŒÙ…
                    // Ø¯Ø± ÙˆØ§Ù‚Ø¹ÛŒØª Ø¨Ø§ÛŒØ¯ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø±Ø§ Ù‡Ù… Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒÙ…
                });
            }
        });
    </script>
</body>
</html>
